###############################################################################
#                                                                             #
# IAR C/C++ Compiler V1.42.1.142 for STM8               01/Jul/2016  17:36:14 #
# Copyright 2010-2013 IAR Systems AB.                                         #
#                                                                             #
#    Source file  =  E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c        #
#    Command line =  E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c -e     #
#                    -Ol --no_cse --no_unroll --no_inline --no_code_motion    #
#                    --no_tbaa --no_cross_call --debug --code_model medium    #
#                    --data_model medium -o E:\hwpro-2016\20160627_L\iar\Debu #
#                    g\Obj\ --dlib_config "C:\Program Files (x86)\IAR         #
#                    Systems\Embedded Workbench 6.5\stm8\LIB\dlstm8mmn.h" -D  #
#                    STM8L15X_MD -lC E:\hwpro-2016\20160627_L\iar\Debug\List\ #
#                     -I E:\hwpro-2016\20160627_L\iar\..\stm8l15x_lib\inc\    #
#                    -I E:\hwpro-2016\20160627_L\iar\..\user\inc\ -I          #
#                    E:\hwpro-2016\20160627_L\iar\..\utils\xprintf\ -I        #
#                    E:\hwpro-2016\20160627_L\iar\..\drivers\ -I              #
#                    E:\hwpro-2016\20160627_L\iar\..\utils\ -I                #
#                    E:\hwpro-2016\20160627_L\iar\..\app\ --vregs 16          #
#    List file    =  E:\hwpro-2016\20160627_L\iar\Debug\List\si446x.lst       #
#    Object file  =  E:\hwpro-2016\20160627_L\iar\Debug\Obj\si446x.o          #
#                                                                             #
#                                                                             #
###############################################################################

E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c
      1          #include "basictype.h"
      2          #include "radio_config.h"
      3          #include "si446x.h"
      4          #include "boardiodef.h"

  typedef unsigned char     uint8_t;
                            ^
"E:\hwpro-2016\20160627_L\stm8l15x_lib\inc\stm8l15x.h",227  Warning[Pe301]: 
          typedef name has already been declared (with same type)

  typedef unsigned short    uint16_t;
                            ^
"E:\hwpro-2016\20160627_L\stm8l15x_lib\inc\stm8l15x.h",228  Warning[Pe301]: 
          typedef name has already been declared (with same type)

  typedef uint16_t u16;
                   ^
"E:\hwpro-2016\20160627_L\stm8l15x_lib\inc\stm8l15x.h",238  Warning[Pe301]: 
          typedef name has already been declared (with same type)

  typedef uint8_t  u8;
                   ^
"E:\hwpro-2016\20160627_L\stm8l15x_lib\inc\stm8l15x.h",239  Warning[Pe301]: 
          typedef name has already been declared (with same type)
      5          #include <string.h>
      6          #include "sysprintf.h"
      7          #include "spi.h"
      8          
      9          
     10          #define SI446X_WAIT_CTS_CNT		32
     11          
     12          static void SI446X_RX_FIFO_RESET( void );
     13          static void SI446X_TX_FIFO_RESET( void );
     14          static void SI446X_TXRX_FIFO_RESET( void );
     15          static void SI446X_GLOGAL_CFG_CMMBINED_FIFO(void);
     16          static void SI446X_GPIO_CONFIG( INT8U G0, INT8U G1, INT8U G2, INT8U G3,INT8U IRQ, INT8U SDO, INT8U GEN_CONFIG );

   \                                 In section .near.rodata, align 1
     17          static const INT8U  si446x_cfg[] = RADIO_CONFIGURATION_DATA_ARRAY;
   \                     si446x_cfg:
   \   000000 07 02 01 00  DC8 7, 2, 1, 0, 1, 201, 195, 128, 8, 19, 0, 0, 0, 0, 0, 0, 0, 6, 17, 0
   \          01 C9 C3 80 
   \   000014 02 00 52 00  DC8 2, 0, 82, 0, 5, 17, 0, 1, 3, 96, 7, 17, 1, 3, 0, 3, 56, 1, 8, 17, 2
   \          05 11 00 01 
   \   000029 04 00 08 04  DC8 4, 0, 8, 4, 6, 9, 13, 17, 16, 9, 0, 8, 20, 0, 15, 49, 0, 0, 0, 0, 9
   \          06 09 0D 11 
   \   00003E 11 11 05 00  DC8 17, 17, 5, 0, 1, 180, 43, 0, 0, 11, 17, 18, 7, 0, 132, 1, 8, 255
   \          01 B4 2B 00 
   \   000050 FF 00 12 10  DC8 255, 0, 18, 16, 17, 18, 12, 8, 0, 0, 0, 10, 54, 0, 1, 4, 130, 0, 57
   \          11 12 0C 08 
   \   000063 00 10 11 12  DC8 0, 16, 17, 18, 12, 20, 42, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16, 17
   \          0C 14 2A 00 
   \   000077 12 0C 20 00  DC8 18, 12, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 17, 18, 9, 44
   \          00 00 00 00 
   \   00008B 00 00 00 00  DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 16, 17, 32, 12, 0, 3, 0, 7, 6, 26, 128
   \          00 00 00 00 
   \   00009F 05 C9 C3 80  DC8 5, 201, 195, 128, 0, 5, 5, 17, 32, 1, 12, 118, 12, 17, 32, 8, 24, 1
   \          00 05 05 11 
   \   0000B1 80 08 03 80  DC8 128, 8, 3, 128, 0, 32, 32, 13, 17, 32, 9, 34, 1, 119, 1, 93, 134, 0
   \          00 20 20 0D 
   \   0000C3 AF 02 C2 0B  DC8 175, 2, 194, 11, 17, 32, 7, 44, 4, 54, 192, 29, 17, 236, 192, 5, 17
   \          11 20 07 2C 
   \   0000D4 20 01 35 E2  DC8 32, 1, 53, 226, 7, 17, 32, 3, 56, 17, 82, 82, 5, 17, 32, 1, 64, 42
   \          07 11 20 03 
   \   0000E6 0D 11 20 09  DC8 13, 17, 32, 9, 66, 164, 2, 214, 131, 0, 173, 1, 128, 255, 5, 17, 32
   \          42 A4 02 D6 
   \   0000F7 01 4C 00 05  DC8 1, 76, 0, 5, 17, 32, 1, 78, 64, 5, 17, 32, 1, 81, 10, 16, 17, 33
   \          11 20 01 4E 
   \   000109 0C 00 CC A1  DC8 12, 0, 204, 161, 48, 160, 33, 209, 185, 201, 234, 5, 18, 17, 16, 17
   \          30 A0 21 D1 
   \   000119 21 0C 0C 0A  DC8 33, 12, 12, 10, 4, 21, 252, 3, 0, 35, 23, 244, 194, 136, 80, 16, 17
   \          04 15 FC 03 
   \   00012A 21 0C 18 21  DC8 33, 12, 24, 33, 255, 236, 230, 232, 238, 246, 251, 5, 192, 255, 15
   \          FF EC E6 E8 
   \   000139 08 11 22 04  DC8 8, 17, 34, 4, 0, 8, 127, 0, 61, 11, 17, 35, 7, 0, 44, 14, 11, 4, 12
   \          00 08 7F 00 
   \   00014C 73 03 10 11  DC8 115, 3, 16, 17, 48, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12
   \          30 0C 00 00 
   \   000160 11 40 08 00  DC8 17, 64, 8, 0, 64, 10, 170, 170, 68, 68, 32, 254, 0
   \          40 0A AA AA 
     18          
     19          

   \                                 In section .near.bss, align 1
     20          static volatile u_char rfchnum = 0;
   \                     rfchnum:
   \   000000              DS8 1
     21          
     22          extern INT8U SPI_SendByteData(INT8U byte);
     23          
     24          //redefine this two variable for deferent cpu and plantform

   \                                 In section .near.bss, align 1
     25          union si446x_cmd_reply_union Si446xCmd;
   \                     Si446xCmd:
   \   000000              DS8 16
     26          
     27          
     28          /*
     29          =================================================================================
     30          SI446X_WAIT_CTS( );
     31          Function : wait the device ready to response a command
     32          INTPUT   : NONE
     33          OUTPUT   : NONE
     34          =================================================================================
     35          */

   \                                 In section .far_func.text, align 1
     36          static void SI446X_WAIT_CTS( void )
     37          {
     38              INT8U cts;
     39              do
     40              {
     41                  RF_SPINSEL(0);
   \                     SI446X_WAIT_CTS:
   \                     ??SI446X_WAIT_CTS_0:
   \   000000 C6 5005      LD        A, L:0x5005
   \   000003 A4 EF        AND       A, #0xef
   \   000005 C7 5005      LD        L:0x5005, A
   \   000008 5F           CLRW      X
   \   000009 97           LD        XL, A
     42                  SPI_SendByteData( READ_CMD_BUFF );
   \   00000A A6 44        LD        A, #0x44
   \   00000C 8D ......    CALLF     SPI_SendByteData
     43                  cts = SPI_SendByteData(0xFF);
   \   000010 A6 FF        LD        A, #0xff
   \   000012 8D ......    CALLF     SPI_SendByteData
   \   000016 B7 ..        LD        S:?b0, A
     44                  RF_SPINSEL(1);
   \   000018 C6 5005      LD        A, L:0x5005
   \   00001B AA 10        OR        A, #0x10
   \   00001D C7 5005      LD        L:0x5005, A
   \   000020 5F           CLRW      X
   \   000021 97           LD        XL, A
     45              }while((cts != 0xFF));
   \   000022 B6 ..        LD        A, S:?b0
   \   000024 A1 FF        CP        A, #0xff
   \   000026 26 D8        JRNE      L:??SI446X_WAIT_CTS_0
     46          }
   \   000028 87           RETF
     47          
     48          
     49          /*
     50          =================================================================================
     51          SI446X_CMD( );
     52          Function : Send a command to the device
     53          INTPUT   : cmd, the buffer stores the command array
     54                     cmdsize, the size of the command array
     55          OUTPUT   : NONE
     56          =================================================================================
     57          */

   \                                 In section .far_func.text, align 1
     58          static void SI446X_CMD( INT8U *cmd, INT8U cmdsize )
     59          {
   \                     SI446X_CMD:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 3B ....      PUSH      S:?b10
   \   000007 BF ..        LDW       S:?w4, X
   \   000009 B7 ..        LD        S:?b10, A
     60              SI446X_WAIT_CTS( );
   \   00000B 8D ......    CALLF     SI446X_WAIT_CTS
     61              RF_SPINSEL(0);
   \   00000F C6 5005      LD        A, L:0x5005
   \   000012 A4 EF        AND       A, #0xef
   \   000014 C7 5005      LD        L:0x5005, A
   \   000017 5F           CLRW      X
   \   000018 97           LD        XL, A
   \   000019 20 0C        JRA       L:??SI446X_CMD_0
     62              while( cmdsize -- )
     63              {
     64                  SPI_SendByteData( *cmd++ );
   \                     ??SI446X_CMD_1:
   \   00001B 92C6 ..      LD        A, [S:?w4.w]
   \   00001E 8D ......    CALLF     SPI_SendByteData
   \   000022 BE ..        LDW       X, S:?w4
   \   000024 5C           INCW      X
   \   000025 BF ..        LDW       S:?w4, X
     65              }
   \                     ??SI446X_CMD_0:
   \   000027 45 .. ..     MOV       S:?b0, S:?b10
   \   00002A B6 ..        LD        A, S:?b0
   \   00002C AB FF        ADD       A, #0xff
   \   00002E B7 ..        LD        S:?b10, A
   \   000030 3D ..        TNZ       S:?b0
   \   000032 26 E7        JRNE      L:??SI446X_CMD_1
     66          	RF_SPINSEL(1);
   \   000034 C6 5005      LD        A, L:0x5005
   \   000037 AA 10        OR        A, #0x10
   \   000039 C7 5005      LD        L:0x5005, A
   \   00003C 5F           CLRW      X
   \   00003D 97           LD        XL, A
     67          }
   \   00003E 32 ....      POP       S:?b10
   \   000041 AC ......    JPF       L:?epilogue_w4
     68          
     69          
     70          
     71          
     72          
     73          /*
     74          =================================================================================
     75          SI446X_POWER_UP( );
     76          Function : Power up the device
     77          INTPUT   : f_xtal, the frequency of the external high-speed crystal
     78          OUTPUT   : NONE
     79          =================================================================================
     80          */
     81          static void SI446X_POWER_UP( INT32U f_xtal )
     82          {
     83              INT8U cmd[7];
     84              cmd[0] = POWER_UP;
     85              cmd[1] = 0x01;
     86              cmd[2] = 0x00;
     87              cmd[3] = f_xtal>>24;
     88              cmd[4] = f_xtal>>16;
     89              cmd[5] = f_xtal>>8;
     90              cmd[6] = f_xtal;
     91              SI446X_CMD( cmd, 7 );
     92          }
     93          
     94          
     95          /*
     96          =================================================================================
     97          SI446X_READ_RESPONSE( );
     98          Function : read a array of command response
     99          INTPUT   : buffer,  a buffer, stores the data responsed
    100                     size,    How many bytes should be read
    101          OUTPUT   : NONE
    102          =================================================================================
    103          */

   \                                 In section .far_func.text, align 1
    104          static void SI446X_READ_RESPONSE( INT8U *buffer, INT8U size )
    105          {
   \                     SI446X_READ_RESPONSE:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 3B ....      PUSH      S:?b10
   \   000007 BF ..        LDW       S:?w4, X
   \   000009 B7 ..        LD        S:?b10, A
    106          	//u_char ubCTS = 0x00;
    107              SI446X_WAIT_CTS( );
   \   00000B 8D ......    CALLF     SI446X_WAIT_CTS
    108              RF_SPINSEL(0);
   \   00000F C6 5005      LD        A, L:0x5005
   \   000012 A4 EF        AND       A, #0xef
   \   000014 C7 5005      LD        L:0x5005, A
   \   000017 5F           CLRW      X
   \   000018 97           LD        XL, A
    109          	SPI_SendByteData( READ_CMD_BUFF );
   \   000019 A6 44        LD        A, #0x44
   \   00001B 8D ......    CALLF     SPI_SendByteData
   \   00001F 20 0E        JRA       L:??SI446X_READ_RESPONSE_0
    110          	//ubCTS = SPI_SendByteData( 0xFF );
    111          	//if (ubCTS == 0xff)
    112          	{
    113          		while( size -- )
    114          	    {
    115          	        *buffer++ = SPI_SendByteData( 0xFF );
   \                     ??SI446X_READ_RESPONSE_1:
   \   000021 A6 FF        LD        A, #0xff
   \   000023 8D ......    CALLF     SPI_SendByteData
   \   000027 92C7 ..      LD        [S:?w4.w], A
   \   00002A BE ..        LDW       X, S:?w4
   \   00002C 5C           INCW      X
   \   00002D BF ..        LDW       S:?w4, X
    116          	    }
   \                     ??SI446X_READ_RESPONSE_0:
   \   00002F 45 .. ..     MOV       S:?b0, S:?b10
   \   000032 B6 ..        LD        A, S:?b0
   \   000034 AB FF        ADD       A, #0xff
   \   000036 B7 ..        LD        S:?b10, A
   \   000038 3D ..        TNZ       S:?b0
   \   00003A 26 E5        JRNE      L:??SI446X_READ_RESPONSE_1
    117              }
    118              RF_SPINSEL(1);
   \   00003C C6 5005      LD        A, L:0x5005
   \   00003F AA 10        OR        A, #0x10
   \   000041 C7 5005      LD        L:0x5005, A
   \   000044 5F           CLRW      X
   \   000045 97           LD        XL, A
    119          }
   \   000046 32 ....      POP       S:?b10
   \   000049 AC ......    JPF       L:?epilogue_w4
    120          
    121          
    122          
    123          /*
    124          =================================================================================
    125          SI446X_NOP( );
    126          Function : NO Operation command
    127          INTPUT   : NONE
    128          OUTPUT   : NONE
    129          =================================================================================
    130          */
    131          static INT8U SI446X_NOP( void )
    132          {
    133              INT8U cts;
    134              RF_SPINSEL(0);
    135              cts = SPI_SendByteData( NOP );
    136              RF_SPINSEL(1);
    137          	return cts;
    138          }
    139          
    140          
    141          
    142          
    143          /*
    144          =================================================================================
    145          SI446X_PART_INFO( );
    146          Function : Read the PART_INFO of the device, 8 bytes needed
    147          INTPUT   : buffer, the buffer stores the part information
    148          OUTPUT   : NONE
    149          =================================================================================
    150          */

   \                                 In section .far_func.text, align 1
    151          void SI446X_PART_INFO( INT8U *buffer )
    152          {
   \                     SI446X_PART_INFO:
   \   000000 52 11        SUB       SP, #0x11
    153              INT8U cmd = PART_INFO;
   \   000002 A6 01        LD        A, #0x1
   \   000004 6B 01        LD        (0x1,SP), A
    154              u_char ubData[16] = {0x00};
   \   000006 90AE ....    LDW       Y, #`?<Constant {0}>`
   \   00000A 96           LDW       X, SP
   \   00000B 1C 0002      ADDW      X, #0x2
   \   00000E 89           PUSHW     X
   \   00000F A6 10        LD        A, #0x10
   \   000011 8D ......    CALLF     L:?move1616_v_x_y_a
   \   000015 85           POPW      X
    155              SI446X_CMD( &cmd, 1 );
   \   000016 A6 01        LD        A, #0x1
   \   000018 96           LDW       X, SP
   \   000019 1C 0001      ADDW      X, #0x1
   \   00001C 8D ......    CALLF     SI446X_CMD
    156              //SI446X_READ_RESPONSE(buffer, 9);
    157              SI446X_READ_RESPONSE(ubData, 8);
   \   000020 A6 08        LD        A, #0x8
   \   000022 96           LDW       X, SP
   \   000023 1C 0002      ADDW      X, #0x2
   \   000026 8D ......    CALLF     SI446X_READ_RESPONSE
    158              MEM_DUMP(0,"part", ubData, 8);
   \   00002A AE 0008      LDW       X, #0x8
   \   00002D BF ..        LDW       S:?w1, X
   \   00002F 96           LDW       X, SP
   \   000030 1C 0002      ADDW      X, #0x2
   \   000033 BF ..        LDW       S:?w0, X
   \   000035 90AE ....    LDW       Y, #`?<Constant "part">`
   \   000039 5F           CLRW      X
   \   00003A 8D ......    CALLF     __xstd_dump
    159          }
   \   00003E 5B 11        ADD       SP, #0x11
   \   000040 87           RETF
    160          
    161          
    162          
    163          /*
    164          =================================================================================
    165          SI446X_FUNC_INFO( );
    166          Function : Read the FUNC_INFO of the device, 7 bytes needed
    167          INTPUT   : buffer, the buffer stores the FUNC information
    168          OUTPUT   : NONE
    169          =================================================================================
    170          */
    171          static void SI446X_FUNC_INFO( INT8U *buffer )
    172          {
    173              INT8U cmd = FUNC_INFO;
    174              SI446X_CMD( &cmd, 1 );
    175              SI446X_READ_RESPONSE( buffer, 7 );
    176          }
    177          
    178          
    179          
    180          /*
    181          =================================================================================
    182          SI446X_INT_STATUS( );
    183          Function : Read the INT status of the device, 9 bytes needed
    184          INTPUT   : buffer, the buffer stores the int status
    185          OUTPUT   : NONE
    186          =================================================================================
    187          */

   \                                 In section .far_func.text, align 1
    188          static void SI446X_INT_STATUS( INT8U *buffer )
    189          {
   \                     SI446X_INT_STATUS:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 52 04        SUB       SP, #0x4
   \   000006 BF ..        LDW       S:?w4, X
    190              INT8U cmd[4];
    191              cmd[0] = GET_INT_STATUS;
   \   000008 A6 20        LD        A, #0x20
   \   00000A 6B 01        LD        (0x1,SP), A
    192              cmd[1] = 0;
   \   00000C 4F           CLR       A
   \   00000D 6B 02        LD        (0x2,SP), A
    193              cmd[2] = 0;
   \   00000F 4F           CLR       A
   \   000010 6B 03        LD        (0x3,SP), A
    194              cmd[3] = 0;
   \   000012 4F           CLR       A
   \   000013 6B 04        LD        (0x4,SP), A
    195          
    196              SI446X_CMD( cmd, 4 );
   \   000015 A6 04        LD        A, #0x4
   \   000017 96           LDW       X, SP
   \   000018 1C 0001      ADDW      X, #0x1
   \   00001B 8D ......    CALLF     SI446X_CMD
    197              SI446X_READ_RESPONSE( buffer, 9 );
   \   00001F A6 09        LD        A, #0x9
   \   000021 BE ..        LDW       X, S:?w4
   \   000023 8D ......    CALLF     SI446X_READ_RESPONSE
    198          }
   \   000027 5B 04        ADD       SP, #0x4
   \   000029 AC ......    JPF       L:?epilogue_w4
    199          
    200          
    201          
    202          
    203          
    204          
    205          
    206          /*
    207          =================================================================================
    208          SI446X_GET_PROPERTY( );
    209          Function : Read the PROPERTY of the device
    210          INTPUT   : buffer, the buffer stores the PROPERTY value
    211                     GROUP_NUM, the group and number of the parameter
    212                     NUM_GROUP, number of the group
    213          OUTPUT   : NONE
    214          =================================================================================
    215          */
    216          static void SI446X_GET_PROPERTY_X( SI446X_PROPERTY GROUP_NUM, INT8U NUM_PROPS, INT8U *buffer  )
    217          {
    218              INT8U cmd[4];
    219          
    220              cmd[0] = GET_PROPERTY;
    221              cmd[1] = GROUP_NUM>>8;
    222              cmd[2] = NUM_PROPS;
    223              cmd[3] = GROUP_NUM;
    224          
    225              SI446X_CMD( cmd, 4 );
    226              SI446X_READ_RESPONSE( buffer, NUM_PROPS + 1 );
    227          }
    228          
    229          
    230          
    231          
    232          /*
    233          =================================================================================
    234          SI446X_SET_PROPERTY_X( );
    235          Function : Set the PROPERTY of the device
    236          INTPUT   : GROUP_NUM, the group and the number of the parameter
    237                     NUM_GROUP, number of the group
    238                     PAR_BUFF, buffer stores parameters
    239          OUTPUT   : NONE
    240          =================================================================================
    241          */
    242          static void SI446X_SET_PROPERTY_X( SI446X_PROPERTY GROUP_NUM, INT8U NUM_PROPS, INT8U *PAR_BUFF )
    243          {
    244              INT8U  cmd[20], i = 0;
    245              if( NUM_PROPS >= 16 )   { return; }
    246              cmd[i++] = SET_PROPERTY;
    247              cmd[i++] = GROUP_NUM>>8;
    248              cmd[i++] = NUM_PROPS;
    249              cmd[i++] = GROUP_NUM;
    250              while( NUM_PROPS-- )
    251              {
    252                  cmd[i++] = *PAR_BUFF++;
    253              }
    254              SI446X_CMD( cmd, i );
    255          }
    256          
    257          
    258          
    259          /*
    260          =================================================================================
    261          SI446X_SET_PROPERTY_1( );
    262          Function : Set the PROPERTY of the device, only 1 byte
    263          INTPUT   : GROUP_NUM, the group and number index
    264                     proerty,  the value to be set
    265          OUTPUT   : NONE
    266          =================================================================================
    267          */

   \                                 In section .far_func.text, align 1
    268          static void SI446X_SET_PROPERTY_1( SI446X_PROPERTY GROUP_NUM, INT8U proerty )
    269          {
   \                     SI446X_SET_PROPERTY_1:
   \   000000 52 05        SUB       SP, #0x5
   \   000002 9093         LDW       Y, X
   \   000004 B7 ..        LD        S:?b0, A
    270              INT8U  cmd[5];
    271              
    272          	//SI446X_WAIT_CTS( );
    273          	
    274              cmd[0] = SET_PROPERTY;
   \   000006 A6 11        LD        A, #0x11
   \   000008 6B 01        LD        (0x1,SP), A
    275              cmd[1] = GROUP_NUM>>8;
   \   00000A 93           LDW       X, Y
   \   00000B 8D ......    CALLF     L:?sra16_x_x_8
   \   00000F 9F           LD        A, XL
   \   000010 6B 02        LD        (0x2,SP), A
    276              cmd[2] = 1;
   \   000012 A6 01        LD        A, #0x1
   \   000014 6B 03        LD        (0x3,SP), A
    277              cmd[3] = GROUP_NUM;
   \   000016 909F         LD        A, YL
   \   000018 6B 04        LD        (0x4,SP), A
    278              cmd[4] = proerty;
   \   00001A B6 ..        LD        A, S:?b0
   \   00001C 6B 05        LD        (0x5,SP), A
    279              SI446X_CMD( cmd, 5 );
   \   00001E A6 05        LD        A, #0x5
   \   000020 96           LDW       X, SP
   \   000021 1C 0001      ADDW      X, #0x1
   \   000024 8D ......    CALLF     SI446X_CMD
    280          }
   \   000028 5B 05        ADD       SP, #0x5
   \   00002A 87           RETF
    281          
    282          
    283          
    284          
    285          /*
    286          =================================================================================
    287          SI446X_GET_PROPERTY_1( );
    288          Function : Get the PROPERTY of the device, only 1 byte
    289          INTPUT   : GROUP_NUM, the group and number index
    290          OUTPUT   : the PROPERTY value read from device
    291          =================================================================================
    292          */

   \                                 In section .far_func.text, align 1, keep-with-next
    293          static INT8U SI446X_GET_PROPERTY_1( SI446X_PROPERTY GROUP_NUM )
    294          {
   \                     SI446X_GET_PROPERTY_1:
   \   000000 52 04        SUB       SP, #0x4
   \   000002 9093         LDW       Y, X
    295              INT8U  cmd[4];
    296          
    297              cmd[0] = GET_PROPERTY;
   \   000004 A6 12        LD        A, #0x12
   \   000006 6B 01        LD        (0x1,SP), A
    298              cmd[1] = GROUP_NUM>>8;
   \   000008 93           LDW       X, Y
   \   000009 8D ......    CALLF     L:?sra16_x_x_8
   \   00000D 9F           LD        A, XL
   \   00000E 6B 02        LD        (0x2,SP), A
    299              cmd[2] = 1;
   \   000010 A6 01        LD        A, #0x1
   \   000012 6B 03        LD        (0x3,SP), A
    300              cmd[3] = GROUP_NUM;
   \   000014 909F         LD        A, YL
   \   000016 6B 04        LD        (0x4,SP), A
    301              SI446X_CMD( cmd, 4 );
   \   000018 A6 04        LD        A, #0x4
   \   00001A 96           LDW       X, SP
   \   00001B 1C 0001      ADDW      X, #0x1
   \   00001E 8D ......    CALLF     SI446X_CMD
    302              SI446X_READ_RESPONSE( cmd, 2 );
   \   000022 A6 02        LD        A, #0x2
   \   000024 96           LDW       X, SP
   \   000025 1C 0001      ADDW      X, #0x1
   \   000028 8D ......    CALLF     SI446X_READ_RESPONSE
    303              return cmd[1];
   \   00002C 7B 02        LD        A, (0x2,SP)
   \   00002E 5B 04        ADD       SP, #0x4
   \   000030 87           RETF
    304          }
    305          /*
    306          =================================================================================
    307          SI446X_RESET( );
    308          Function : reset the SI446x device
    309          INTPUT   : NONE
    310          OUTPUT   : NONE
    311          =================================================================================
    312          */
    313          static void SI446X_RESET( void )
    314          {
    315              RF_SDN(1);
    316              //clock_wait(1);
    317              /*delay code*/
    318              
    319              RF_SDN(0);
    320              /*delay code*/
    321              //clock_wait(50);
    322              
    323              RF_SPINSEL(1);
    324          }
    325          
    326          
    327          /*!
    328           * This function is used to load all properties and commands with a list of NULL terminated commands.
    329           * Before this function @si446x_reset should be called.
    330           */

   \                                 In section .far_func.text, align 1, keep-with-next
    331          static INT8U SI446X_CFG_PARAM_INIT(const INT8U* pSetPropCmd)
    332          {
   \                     SI446X_CFG_PARAM_INIT:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 52 10        SUB       SP, #0x10
   \   000006 BF ..        LDW       S:?w4, X
   \   000008 20 2E        JRA       L:??SI446X_CFG_PARAM_INIT_0
    333          	INT8U col;
    334          	INT8U numOfBytes;
    335          	INT8U ubacmd[16];
    336          
    337          	/* While cycle as far as the pointer points to a command */
    338          	while (*pSetPropCmd != 0x00)
    339          	{
    340          		/* Commands structure in the array:
    341          		* --------------------------------
    342          		* LEN | <LEN length of data>
    343          		*/
    344          
    345          		numOfBytes = *pSetPropCmd++;
    346          
    347          		if (numOfBytes > 16u)
    348          		{
    349          			/* Number of command bytes exceeds maximal allowable length */
    350          			return 1;
    351          		}
    352          
    353          		for (col = 0u; col < numOfBytes; col++)
    354          		{
    355          			ubacmd[col] = *pSetPropCmd;
   \                     ??SI446X_CFG_PARAM_INIT_1:
   \   00000A 5F           CLRW      X
   \   00000B 41           EXG       A, XL
   \   00000C B6 ..        LD        A, S:?b0
   \   00000E 41           EXG       A, XL
   \   00000F BF ..        LDW       S:?w1, X
   \   000011 96           LDW       X, SP
   \   000012 1C 0001      ADDW      X, #0x1
   \   000015 72BB ....    ADDW      X, S:?w1
   \   000019 92C6 ..      LD        A, [S:?w4.w]
   \   00001C F7           LD        (X), A
    356          			pSetPropCmd++;
   \   00001D BE ..        LDW       X, S:?w4
   \   00001F 5C           INCW      X
   \   000020 BF ..        LDW       S:?w4, X
    357          		}
   \   000022 B6 ..        LD        A, S:?b0
   \   000024 AB 01        ADD       A, #0x1
   \   000026 B7 ..        LD        S:?b0, A
   \                     ??SI446X_CFG_PARAM_INIT_2:
   \   000028 B6 ..        LD        A, S:?b0
   \   00002A B1 ..        CP        A, S:?b1
   \   00002C 25 DC        JRC       L:??SI446X_CFG_PARAM_INIT_1
    358          		SI446X_CMD(ubacmd, numOfBytes);
   \   00002E B6 ..        LD        A, S:?b1
   \   000030 96           LDW       X, SP
   \   000031 1C 0001      ADDW      X, #0x1
   \   000034 8D ......    CALLF     SI446X_CMD
   \                     ??SI446X_CFG_PARAM_INIT_0:
   \   000038 923D ..      TNZ       [S:?w4.w]
   \   00003B 27 18        JREQ      L:??SI446X_CFG_PARAM_INIT_3
   \   00003D 92C6 ..      LD        A, [S:?w4.w]
   \   000040 B7 ..        LD        S:?b1, A
   \   000042 BE ..        LDW       X, S:?w4
   \   000044 5C           INCW      X
   \   000045 BF ..        LDW       S:?w4, X
   \   000047 B6 ..        LD        A, S:?b1
   \   000049 A1 11        CP        A, #0x11
   \   00004B 25 04        JRC       L:??SI446X_CFG_PARAM_INIT_4
   \   00004D A6 01        LD        A, #0x1
   \   00004F 20 05        JRA       L:??SI446X_CFG_PARAM_INIT_5
   \                     ??SI446X_CFG_PARAM_INIT_4:
   \   000051 3F ..        CLR       S:?b0
   \   000053 20 D3        JRA       L:??SI446X_CFG_PARAM_INIT_2
    359          	}
    360          
    361          	return 0;
   \                     ??SI446X_CFG_PARAM_INIT_3:
   \   000055 4F           CLR       A
   \                     ??SI446X_CFG_PARAM_INIT_5:
   \   000056 5B 10        ADD       SP, #0x10
   \   000058 AC ......    JPF       L:?epilogue_w4
    362          }
    363          
    364          
    365          
    366          /*
    367          =================================================================================
    368          SI446X_CONFIG_INIT( );
    369          Function : configuration the device
    370          INTPUT   : NONE
    371          OUTPUT   : NONE
    372          =================================================================================
    373          */
    374          static void SI446X_CONFIG_INIT( void )
    375          {
    376          	#if 0
    377              INT8U i;
    378              INT16U j = 0;
    379          	u_char *pcfg = (u_char *)si446x_cfg;
    380              while( ( i = pcfg[j] ) != 0 )
    381              {
    382                  j += 1;
    383                  SI446X_CMD( pcfg + j, i );
    384                  j += i;
    385              }
    386          	#else
    387          	SI446X_CFG_PARAM_INIT(si446x_cfg);
    388          	#endif
    389              
    390          #if PACKET_LENGTH > 0           //fixed packet length
    391              SI446X_SET_PROPERTY_1( PKT_FIELD_1_LENGTH_7_0, PACKET_LENGTH );
    392              SI446X_SET_PROPERTY_1( PKT_FIELD_1_CRC_CONFIG, 0xA2 );
    393              SI446X_SET_PROPERTY_1( PKT_CRC_CONFIG, 0x05 );
    394          #else                           //variable packet length
    395          	#if 1
    396              SI446X_SET_PROPERTY_1( PKT_CONFIG1, 0x00 );
    397              SI446X_SET_PROPERTY_1( PKT_CRC_CONFIG, 0x00 );
    398              SI446X_SET_PROPERTY_1( PKT_LEN_FIELD_SOURCE, 0x01 );
    399              SI446X_SET_PROPERTY_1( PKT_LEN, 0x2A );
    400              SI446X_SET_PROPERTY_1( PKT_LEN_ADJUST, 0x00 );
    401              SI446X_SET_PROPERTY_1( PKT_FIELD_1_LENGTH_12_8, 0x00 );
    402              SI446X_SET_PROPERTY_1( PKT_FIELD_1_LENGTH_7_0, 0x01 );
    403              SI446X_SET_PROPERTY_1( PKT_FIELD_1_CONFIG, 0x00 );
    404              SI446X_SET_PROPERTY_1( PKT_FIELD_1_CRC_CONFIG, 0x00 );
    405              SI446X_SET_PROPERTY_1( PKT_FIELD_2_LENGTH_12_8, 0x00 );
    406              //SI446X_SET_PROPERTY_1( PKT_FIELD_2_LENGTH_7_0, 0x10 );
    407              SI446X_SET_PROPERTY_1( PKT_FIELD_2_LENGTH_7_0, 0x80 );
    408              SI446X_SET_PROPERTY_1( PKT_FIELD_2_CONFIG, 0x00 );
    409              SI446X_SET_PROPERTY_1( PKT_FIELD_2_CRC_CONFIG, 0x00 );
    410              #else
    411              //SI446X_SET_PROPERTY_1( PKT_CONFIG1, 0x00 ); //crc not ivert,lisbyte first,msbit first
    412              //SI446X_SET_PROPERTY_1( PKT_CRC_CONFIG, 0x04 );//crc seed 0, CRC_16_IBM
    413              SI446X_SET_PROPERTY_1( PKT_LEN_FIELD_SOURCE, 0x01 );//field is packet length
    414              SI446X_SET_PROPERTY_1( PKT_LEN, 0x2A );//msbyte first,1byte len,len save fifo,field 2 is var field
    415              SI446X_SET_PROPERTY_1( PKT_LEN_ADJUST, (INT8U)-3);//0xfd 1 byte packet field, 2 bytes crc
    416              SI446X_SET_PROPERTY_1( PKT_FIELD_1_LENGTH_12_8, 0x00 );
    417              SI446X_SET_PROPERTY_1( PKT_FIELD_1_LENGTH_7_0, 0x01 );
    418              //SI446X_SET_PROPERTY_1( PKT_FIELD_1_CONFIG, 0x00 );
    419              //SI446X_SET_PROPERTY_1( PKT_FIELD_1_CRC_CONFIG, 0x80|0x02);//start crc from this field, and enable
    420              SI446X_SET_PROPERTY_1( PKT_FIELD_2_LENGTH_12_8, 0x00 );
    421              SI446X_SET_PROPERTY_1( PKT_FIELD_2_LENGTH_7_0, 0x10);//max byte 129
    422              //SI446X_SET_PROPERTY_1( PKT_FIELD_2_CONFIG, 0x00 );
    423              //SI446X_SET_PROPERTY_1( PKT_FIELD_2_CRC_CONFIG, 0x20|0x08|0x02);//send crc, check crc, crc enable
    424              #endif
    425          #endif //PACKET_LENGTH
    426          
    427              //重要： 4463的GDO2，GDO3控制射频开关，  0X20 ,0X21 
    428              //发射时必须： GDO2=1，GDO3=0
    429              //接收时必须： GDO2=0，GDO3=1
    430              SI446X_GPIO_CONFIG( 0, 0, 0x20, 0x21, 0, 0, 0 );//重要
    431          
    432          }
    433          
    434          
    435          /*
    436          =================================================================================
    437          SI446X_RADIO_CONFIG_INIT( );
    438          Function : configuration the device
    439          INTPUT   : NONE
    440          OUTPUT   : NONE
    441          =================================================================================
    442          */

   \                                 In section .far_func.text, align 1, keep-with-next
    443          static void SI446X_RADIO_CONFIG_INIT( void )
    444          {
    445          	SI446X_CFG_PARAM_INIT(si446x_cfg);
   \                     SI446X_RADIO_CONFIG_INIT:
   \   000000 AE ....      LDW       X, #si446x_cfg
   \   000003              REQUIRE SI446X_CFG_PARAM_INIT
   \   000003              ;               // Fall through to label SI446X_CFG_PARAM_INIT
    446          }
    447          
    448          /*
    449          =================================================================================
    450          SI446X_RADIO_PKT_COMMON_CFG( );
    451          Function : configuration pkt tx and rx common
    452          INTPUT   : NONE
    453          OUTPUT   : NONE
    454          0x120d-0x1220
    455          =================================================================================
    456          */

   \                                 In section .far_func.text, align 1, keep-with-next
    457          static void SI446X_RADIO_PKT_COMMON_CFG( void )
    458          {
    459          	#if 0
    460              SI446X_SET_PROPERTY_1(PKT_CRC_CONFIG, 0x05);//used all 0 for crc seed,CCIT-16: X16+X12+X5+1.
    461              SI446X_SET_PROPERTY_1(PKT_CONFIG1,0x80);//filed split,packet handler enable, manch 01, crc no invert, crc low byte first, MSB first
    462              #else
    463              SI446X_SET_PROPERTY_1(PKT_CRC_CONFIG, 0x00);//used all 0 for crc seed,CCIT-16: X16+X12+X5+1.
   \                     SI446X_RADIO_PKT_COMMON_CFG:
   \   000000 4F           CLR       A
   \   000001 AE 1200      LDW       X, #0x1200
   \   000004 8D ......    CALLF     SI446X_SET_PROPERTY_1
    464              SI446X_SET_PROPERTY_1(PKT_CONFIG1,0x80);//filed split,packet handler enable, manch 01, crc no invert, crc low byte first, MSB first
   \   000008 A6 80        LD        A, #0x80
   \   00000A AE 1206      LDW       X, #0x1206
   \   00000D 8D ......    CALLF     SI446X_SET_PROPERTY_1
    465              #endif
    466          
    467          	//open rx ,tx ,crc, syde 
    468          	SI446X_SET_PROPERTY_1(INT_CTL_ENABLE, 0x07);//open PH, MODEM
   \   000011 A6 07        LD        A, #0x7
   \   000013 AE 0100      LDW       X, #0x100
   \   000016 8D ......    CALLF     SI446X_SET_PROPERTY_1
    469          	SI446X_SET_PROPERTY_1(INT_CTL_PH_ENABLE, SI446X_INT_CTL_PH_PSENT_EN|SI446X_INT_CTL_PH_PRX_EN);
   \   00001A A6 30        LD        A, #0x30
   \   00001C AE 0101      LDW       X, #0x101
   \   00001F 8D ......    CALLF     SI446X_SET_PROPERTY_1
    470          	SI446X_SET_PROPERTY_1(INT_CTL_MODEM_ENABLE, SI446X_INT_CTL_MODEM_SYDE_EN);
   \   000023 A6 01        LD        A, #0x1
   \   000025 AE 0102      LDW       X, #0x102
   \   000028 8D ......    CALLF     SI446X_SET_PROPERTY_1
    471          	SI446X_SET_PROPERTY_1(INT_CTL_CHIP_ENABLE, SI446X_INT_CTL_CHIP_CMERR_EN);
   \   00002C A6 08        LD        A, #0x8
   \   00002E AE 0103      LDW       X, #0x103
   \   000031 AC ......    JPF       SI446X_SET_PROPERTY_1
    472          }
    473          
    474          /*
    475          =================================================================================
    476          SI446X_RADIO_TX_FIELD_CFG( );
    477          Function : configuration tx field data
    478          INTPUT   : NONE
    479          OUTPUT   : NONE
    480          0x120d-0x1220
    481          =================================================================================
    482          */

   \                                 In section .far_func.text, align 1, keep-with-next
    483          static void SI446X_RADIO_TX_FIELD_CFG( void )
    484          {
    485          	SI446X_SET_PROPERTY_1(PKT_FIELD_1_LENGTH_7_0, 0x01);  //1 byte for packet length
   \                     SI446X_RADIO_TX_FIELD_CFG:
   \   000000 A6 01        LD        A, #0x1
   \   000002 AE 120E      LDW       X, #0x120e
   \   000005 8D ......    CALLF     SI446X_SET_PROPERTY_1
    486          	SI446X_SET_PROPERTY_1(PKT_FIELD_1_LENGTH_12_8, 0x00);
   \   000009 4F           CLR       A
   \   00000A AE 120D      LDW       X, #0x120d
   \   00000D 8D ......    CALLF     SI446X_SET_PROPERTY_1
    487          	SI446X_SET_PROPERTY_1(PKT_FIELD_1_CONFIG, 0x00); //
   \   000011 4F           CLR       A
   \   000012 AE 120F      LDW       X, #0x120f
   \   000015 8D ......    CALLF     SI446X_SET_PROPERTY_1
    488          	//SI446X_SET_PROPERTY_1(PKT_FIELD_1_CRC_CONFIG, 0x80);//start crc, disable crc
    489          	SI446X_SET_PROPERTY_1(PKT_FIELD_1_CRC_CONFIG, 0x00);//start crc, disable crc
   \   000019 4F           CLR       A
   \   00001A AE 1210      LDW       X, #0x1210
   \   00001D 8D ......    CALLF     SI446X_SET_PROPERTY_1
    490          
    491          
    492          	SI446X_SET_PROPERTY_1(PKT_FIELD_2_LENGTH_7_0, 0x80);//max length 128
   \   000021 A6 80        LD        A, #0x80
   \   000023 AE 1212      LDW       X, #0x1212
   \   000026 8D ......    CALLF     SI446X_SET_PROPERTY_1
    493          	SI446X_SET_PROPERTY_1(PKT_FIELD_2_LENGTH_12_8, 0x00);
   \   00002A 4F           CLR       A
   \   00002B AE 1211      LDW       X, #0x1211
   \   00002E 8D ......    CALLF     SI446X_SET_PROPERTY_1
    494          	SI446X_SET_PROPERTY_1(PKT_FIELD_2_CONFIG, 0x00);
   \   000032 4F           CLR       A
   \   000033 AE 1213      LDW       X, #0x1213
   \   000036 8D ......    CALLF     SI446X_SET_PROPERTY_1
    495          	//SI446X_SET_PROPERTY_1(PKT_FIELD_2_CRC_CONFIG, 0x22);//send crc, enable crc
    496          	SI446X_SET_PROPERTY_1(PKT_FIELD_2_CRC_CONFIG, 0x00);//disable send crc, disable crc
   \   00003A 4F           CLR       A
   \   00003B AE 1214      LDW       X, #0x1214
   \   00003E AC ......    JPF       SI446X_SET_PROPERTY_1
    497          
    498          }
    499          
    500          
    501          /*
    502          =================================================================================
    503          SI446X_RADIO_RX_FIELD_CFG( );
    504          Function : configuration rx field data
    505          INTPUT   : NONE
    506          OUTPUT   : NONE
    507          0x1221-0x1234
    508          =================================================================================
    509          */

   \                                 In section .far_func.text, align 1, keep-with-next
    510          static void SI446X_RADIO_RX_FIELD_CFG( void )
    511          {
    512          	SI446X_SET_PROPERTY_1(PKT_LEN, 0x2a);//rx msb first, 1 byte length,length put in fifo, field 2 is variable length field.
   \                     SI446X_RADIO_RX_FIELD_CFG:
   \   000000 A6 2A        LD        A, #0x2a
   \   000002 AE 1208      LDW       X, #0x1208
   \   000005 8D ......    CALLF     SI446X_SET_PROPERTY_1
    513          	SI446X_SET_PROPERTY_1(PKT_LEN_FIELD_SOURCE, 0x01);//field 1 is packet length
   \   000009 A6 01        LD        A, #0x1
   \   00000B AE 1209      LDW       X, #0x1209
   \   00000E 8D ......    CALLF     SI446X_SET_PROPERTY_1
    514          	SI446X_SET_PROPERTY_1(PKT_LEN_ADJUST, (INT8U)(0x00));//paket format is l byte length, packet data, 0 byte crc
   \   000012 4F           CLR       A
   \   000013 AE 120A      LDW       X, #0x120a
   \   000016 8D ......    CALLF     SI446X_SET_PROPERTY_1
    515          
    516          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_1_LENGTH_7_0, 0x01);//1byte packet length
   \   00001A A6 01        LD        A, #0x1
   \   00001C AE 1222      LDW       X, #0x1222
   \   00001F 8D ......    CALLF     SI446X_SET_PROPERTY_1
    517          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_1_LENGTH_12_8, 0x00);//
   \   000023 4F           CLR       A
   \   000024 AE 1221      LDW       X, #0x1221
   \   000027 8D ......    CALLF     SI446X_SET_PROPERTY_1
    518          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_1_CONFIG, 0x00);
   \   00002B 4F           CLR       A
   \   00002C AE 1223      LDW       X, #0x1223
   \   00002F 8D ......    CALLF     SI446X_SET_PROPERTY_1
    519          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_1_CRC_CONFIG, 0x00);//start crc, enable crc
   \   000033 4F           CLR       A
   \   000034 AE 1224      LDW       X, #0x1224
   \   000037 8D ......    CALLF     SI446X_SET_PROPERTY_1
    520          
    521          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_2_LENGTH_12_8, 0x00);
   \   00003B 4F           CLR       A
   \   00003C AE 1225      LDW       X, #0x1225
   \   00003F 8D ......    CALLF     SI446X_SET_PROPERTY_1
    522          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_2_LENGTH_7_0, 0x80);//128
   \   000043 A6 80        LD        A, #0x80
   \   000045 AE 1226      LDW       X, #0x1226
   \   000048 8D ......    CALLF     SI446X_SET_PROPERTY_1
    523          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_2_CONFIG, 0x00);
   \   00004C 4F           CLR       A
   \   00004D AE 1227      LDW       X, #0x1227
   \   000050 8D ......    CALLF     SI446X_SET_PROPERTY_1
    524          	SI446X_SET_PROPERTY_1(PKT_RX_FIELD_2_CRC_CONFIG, 0x00);//check crc, enable crc
   \   000054 4F           CLR       A
   \   000055 AE 1228      LDW       X, #0x1228
   \   000058 AC ......    JPF       SI446X_SET_PROPERTY_1
    525          }
    526          
    527          
    528          
    529          /*!
    530           * Issue a change state command to the radio.
    531           *
    532           * @param NEXT_STATE1 Next state.
    533           */

   \                                 In section .far_func.text, align 1, keep-with-next
    534          static void SI446X_CHANGE_STATE(INT8U NEXT_STATE1)
    535          {
   \                     SI446X_CHANGE_STATE:
   \   000000 52 02        SUB       SP, #0x2
   \   000002 B7 ..        LD        S:?b0, A
    536          	INT8U ubacmd[2] = {0x00};
   \   000004 90AE ....    LDW       Y, #`?<Constant {0}>_1`
   \   000008 96           LDW       X, SP
   \   000009 1C 0001      ADDW      X, #0x1
   \   00000C 89           PUSHW     X
   \   00000D A6 02        LD        A, #0x2
   \   00000F 8D ......    CALLF     L:?move1616_v_x_y_a
   \   000013 85           POPW      X
    537              ubacmd[0] = SI446X_CMD_ID_CHANGE_STATE;
   \   000014 A6 34        LD        A, #0x34
   \   000016 6B 01        LD        (0x1,SP), A
    538              ubacmd[1] = NEXT_STATE1;
   \   000018 B6 ..        LD        A, S:?b0
   \   00001A 6B 02        LD        (0x2,SP), A
    539          
    540              SI446X_CMD(ubacmd, 2);
   \   00001C A6 02        LD        A, #0x2
   \   00001E 96           LDW       X, SP
   \   00001F 1C 0001      ADDW      X, #0x1
   \   000022 8D ......    CALLF     SI446X_CMD
    541          }
   \   000026 5B 02        ADD       SP, #0x2
   \   000028 87           RETF
    542          
    543          /*
    544          =================================================================================
    545          SI446X_W_TX_FIFO( );
    546          Function : write data to TX fifo
    547          INTPUT   : txbuffer, a buffer stores TX array
    548                     size,  how many bytes should be written
    549          OUTPUT   : NONE
    550          =================================================================================
    551          */
    552          static void SI446X_W_TX_FIFO( INT8U *txbuffer, INT8U size )
    553          {
    554              RF_SPINSEL(0);
    555              SPI_SendByteData( WRITE_TX_FIFO );
    556              while( size -- )    
    557              { 
    558              	SPI_SendByteData( *txbuffer++ ); 
    559              }
    560              RF_SPINSEL(1);
    561          }
    562          
    563          /*
    564          =================================================================================
    565          SI446X_SEND_DATA( );
    566          Function : send data , data length > 64
    567          INTPUT   : txbuffer, a buffer stores TX array
    568                     size,  how many bytes should be written
    569                     channel, tx channel
    570                     condition, tx condition
    571          OUTPUT   : sent flag : 1 success, 0 failed
    572          =================================================================================
    573          */
    574          static void  SI446X_SEND_DATA( INT8U *txbuffer, INT8U size, INT8U channel, INT8U condition )
    575          {
    576              INT8U cmd[5];
    577              INT8U tx_len = size;
    578              INT8U i = 0;
    579             
    580          
    581          //    SI446X_TX_FIFO_RESET( );
    582              SI446X_TXRX_FIFO_RESET( );
    583              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
    584          
    585              RF_SPINSEL(0);
    586              SPI_SendByteData( WRITE_TX_FIFO );
    587          #if PACKET_LENGTH == 0
    588              //tx_len ++;
    589              tx_len += 1;//
    590              SPI_SendByteData( size );
    591          #endif
    592          	#if 0
    593              while( size -- )    
    594              { 
    595              	SPI_SendByteData( *txbuffer++ ); 
    596              }
    597              #endif
    598              for (i = 0; i < size; i++)
    599              {
    600              	SPI_SendByteData( txbuffer[i]); 
    601              }
    602              RF_SPINSEL(1);
    603              cmd[0] = START_TX;
    604              cmd[1] = channel;
    605              cmd[2] = condition;
    606              cmd[3] = 0;
    607              cmd[4] = tx_len;
    608              SI446X_CMD( cmd, 5 );
    609          	RF_SPINSEL(1);
    610          }
    611          
    612          
    613          
    614          
    615          /*
    616          =================================================================================
    617          SI446X_START_TX( );
    618          Function : start TX command
    619          INTPUT   : channel, tx channel
    620                     condition, tx condition
    621                     tx_len, how many bytes to be sent
    622          OUTPUT   : NONE
    623          =================================================================================
    624          */

   \                                 In section .far_func.text, align 1, keep-with-next
    625          static void SI446X_START_TX( INT8U channel, INT8U condition, INT16U tx_len )
    626          {
   \                     SI446X_START_TX:
   \   000000 52 05        SUB       SP, #0x5
   \   000002 B7 ..        LD        S:?b1, A
   \   000004 9093         LDW       Y, X
    627              INT8U cmd[5];
    628          
    629              cmd[0] = START_TX;
   \   000006 A6 31        LD        A, #0x31
   \   000008 6B 01        LD        (0x1,SP), A
    630              cmd[1] = channel;
   \   00000A B6 ..        LD        A, S:?b1
   \   00000C 6B 02        LD        (0x2,SP), A
    631              cmd[2] = condition;
   \   00000E B6 ..        LD        A, S:?b0
   \   000010 6B 03        LD        (0x3,SP), A
    632              cmd[3] = tx_len>>8;
   \   000012 93           LDW       X, Y
   \   000013 4F           CLR       A
   \   000014 01           RRWA      X, A
   \   000015 9F           LD        A, XL
   \   000016 6B 04        LD        (0x4,SP), A
    633              cmd[4] = tx_len;
   \   000018 909F         LD        A, YL
   \   00001A 6B 05        LD        (0x5,SP), A
    634              SI446X_CMD( cmd, 5 );
   \   00001C A6 05        LD        A, #0x5
   \   00001E 96           LDW       X, SP
   \   00001F 1C 0001      ADDW      X, #0x1
   \   000022 8D ......    CALLF     SI446X_CMD
    635          }
   \   000026 5B 05        ADD       SP, #0x5
   \   000028 87           RETF
    636          /*
    637          =================================================================================
    638          SI446X_READ_PACKET( );
    639          Function : read RX fifo
    640          INTPUT   : buffer, a buffer to store data read
    641          OUTPUT   : received bytes
    642          =================================================================================
    643          */
    644          static INT8U SI446X_READ_PACKET( INT8U *buffer )
    645          {
    646              INT8U length = 0;
    647              INT8U i = 0;;
    648              //user add
    649              //INT8U packetLen = 0;
    650              INT8U *pBuf = buffer+1;
    651              SI446X_WAIT_CTS( );
    652              RF_SPINSEL(0);
    653          
    654              SPI_SendByteData( READ_RX_FIFO );
    655          #if PACKET_LENGTH == 0
    656              length = SPI_SendByteData( 0xFF );
    657              //user add
    658              
    659              buffer[0] = SPI_SendByteData( 0xFF );
    660          
    661              XPRINTF((0, "L = %02x, bL = %02x\r\n", length, buffer[0]));
    662              if (length >= (buffer[0] + 1))
    663              	length = buffer[0];
    664              else
    665              	length = buffer[0];
    666          #else
    667              length = PACKET_LENGTH;
    668          #endif
    669              i = length;
    670              while( length -- )
    671              {
    672                  //*buffer++ = SPI_SendByteData( 0xFF );
    673                  *pBuf++ = SPI_SendByteData( 0xFF );
    674              }
    675              RF_SPINSEL(1);
    676              return i;
    677          }
    678          
    679          static void SI446X_READ_PACKET_LEN( INT8U *pibuf )
    680          {
    681              SI446X_WAIT_CTS( );
    682              RF_SPINSEL(0);
    683          
    684              SPI_SendByteData( READ_RX_FIFO );
    685          #if PACKET_LENGTH == 0
    686              pibuf[0] = SPI_SendByteData( 0xFF );
    687              pibuf[1] = SPI_SendByteData( 0xFF );
    688              RF_SPINSEL(1);
    689          #endif
    690          }
    691          
    692          
    693          
    694          
    695          /*
    696          =================================================================================
    697          SI446X_READ_DATA_TO_BUF( );
    698          Function : read RX fifo
    699          INTPUT   : buffer, a buffer to store data read
    700          OUTPUT   : received bytes
    701          =================================================================================
    702          */
    703          static INT8U SI446X_READ_DATA_TO_BUF( INT8U *pbuf , INT8U ubNum)
    704          {
    705          	INT8U length;
    706              INT8U i = 0;
    707              SI446X_WAIT_CTS( );
    708              RF_SPINSEL(0);
    709          
    710              SPI_SendByteData( READ_RX_FIFO );
    711              length = ubNum;
    712              i = length;
    713              while( length -- )
    714              {
    715                  //*buffer++ = SPI_SendByteData( 0xFF );
    716                  *pbuf++ = SPI_SendByteData( 0xFF );
    717              }
    718              RF_SPINSEL(1);
    719              return i;
    720          }
    721          
    722          
    723          
    724          /*
    725          =================================================================================
    726          SI446X_START_RX( );
    727          Function : start RX state
    728          INTPUT   : channel, receive channel
    729                     condition, receive condition
    730                     rx_len, how many bytes should be read
    731                     n_state1, next state 1
    732                     n_state2, next state 2
    733                     n_state3, next state 3
    734          OUTPUT   : NONE
    735          =================================================================================
    736          */
    737          //static void SI446X_START_RX( INT8U channel, INT8U condition, INT16U rx_len,
    738          //                      INT8U n_state1, INT8U n_state2, INT8U n_state3 )
    739          

   \                                 In section .far_func.text, align 1, keep-with-next
    740          static void SI446X_START_RX( SI446X_RF_CH channel, SI446X_RX_CONDITION condition, INT16U rx_len,
    741                                SI446X_DEV_STATE n_state1, SI446X_DEV_STATE n_state2, SI446X_DEV_STATE n_state3 )
    742                                
    743          {
   \                     SI446X_START_RX:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 8D ......    CALLF     L:?push_w6
   \   000008 3B ....      PUSH      S:?b14
   \   00000B 52 08        SUB       SP, #0x8
   \   00000D B7 ..        LD        S:?b14, A
   \   00000F 45 .. ..     MOV       S:?b13, S:?b0
   \   000012 BF ..        LDW       S:?w4, X
   \   000014 45 .. ..     MOV       S:?b10, S:?b1
   \   000017 45 .. ..     MOV       S:?b11, S:?b2
   \   00001A 45 .. ..     MOV       S:?b12, S:?b3
    744              INT8U cmd[8];
    745              //SI446X_RX_FIFO_RESET( );
    746              //SI446X_TX_FIFO_RESET( );
    747              SI446X_TXRX_FIFO_RESET( );
   \   00001D 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
    748              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   000021 8D ......    CALLF     SI446X_GLOGAL_CFG_CMMBINED_FIFO
    749          
    750              cmd[0] = START_RX;
   \   000025 A6 32        LD        A, #0x32
   \   000027 6B 01        LD        (0x1,SP), A
    751              cmd[1] = channel;
   \   000029 B6 ..        LD        A, S:?b14
   \   00002B 6B 02        LD        (0x2,SP), A
    752              cmd[2] = condition;
   \   00002D B6 ..        LD        A, S:?b13
   \   00002F 6B 03        LD        (0x3,SP), A
    753              cmd[3] = rx_len>>8;
   \   000031 BE ..        LDW       X, S:?w4
   \   000033 4F           CLR       A
   \   000034 01           RRWA      X, A
   \   000035 9F           LD        A, XL
   \   000036 6B 04        LD        (0x4,SP), A
    754              cmd[4] = rx_len;
   \   000038 B6 ..        LD        A, S:?b9
   \   00003A 6B 05        LD        (0x5,SP), A
    755              cmd[5] = n_state1;
   \   00003C B6 ..        LD        A, S:?b10
   \   00003E 6B 06        LD        (0x6,SP), A
    756              cmd[6] = n_state2;
   \   000040 B6 ..        LD        A, S:?b11
   \   000042 6B 07        LD        (0x7,SP), A
    757              cmd[7] = n_state3;
   \   000044 B6 ..        LD        A, S:?b12
   \   000046 6B 08        LD        (0x8,SP), A
    758              SI446X_CMD( cmd, 8 );
   \   000048 A6 08        LD        A, #0x8
   \   00004A 96           LDW       X, SP
   \   00004B 1C 0001      ADDW      X, #0x1
   \   00004E 8D ......    CALLF     SI446X_CMD
    759          }
   \   000052 5B 08        ADD       SP, #0x8
   \   000054 32 ....      POP       S:?b14
   \   000057 AC ......    JPF       L:?epilogue_l2_w6
    760          /*
    761          =================================================================================
    762          SI446X_RX_FIFO_RESET( );
    763          Function : reset the RX FIFO of the device
    764          INTPUT   : None
    765          OUTPUT   : NONE
    766          =================================================================================
    767          */
    768          static void SI446X_RX_FIFO_RESET( void )
    769          {
    770              INT8U cmd[2];
    771          
    772              cmd[0] = FIFO_INFO;
    773              cmd[1] = 0x02;
    774              SI446X_CMD( cmd, 2 );
    775          }
    776          /*
    777          =================================================================================
    778          SI446X_TX_FIFO_RESET( );
    779          Function : reset the TX FIFO of the device
    780          INTPUT   : None
    781          OUTPUT   : NONE
    782          =================================================================================
    783          */
    784          static void SI446X_TX_FIFO_RESET( void )
    785          {
    786              INT8U cmd[2];
    787          
    788              cmd[0] = FIFO_INFO;
    789              cmd[1] = 0x01;
    790              SI446X_CMD( cmd, 2 );
    791          }
    792          
    793          
    794          /*
    795          =================================================================================
    796          SI446X_TXRX_FIFO_RESET( );
    797          Function : reset the TX AND RX FIFO of the device
    798          INTPUT   : None
    799          OUTPUT   : NONE
    800          =================================================================================
    801          */

   \                                 In section .far_func.text, align 1, keep-with-next
    802          static void SI446X_TXRX_FIFO_RESET( void )
    803          {
   \                     SI446X_TXRX_FIFO_RESET:
   \   000000 52 02        SUB       SP, #0x2
    804              INT8U cmd[2];
    805          
    806              cmd[0] = FIFO_INFO;
   \   000002 A6 15        LD        A, #0x15
   \   000004 6B 01        LD        (0x1,SP), A
    807              cmd[1] = 0x03;
   \   000006 A6 03        LD        A, #0x3
   \   000008 6B 02        LD        (0x2,SP), A
    808              SI446X_CMD( cmd, 2 );
   \   00000A A6 02        LD        A, #0x2
   \   00000C 96           LDW       X, SP
   \   00000D 1C 0001      ADDW      X, #0x1
   \   000010 8D ......    CALLF     SI446X_CMD
    809          }
   \   000014 5B 02        ADD       SP, #0x2
   \   000016 87           RETF
    810          
    811          
    812          
    813          /*
    814          =================================================================================
    815          SI446X_PKT_INFO( );
    816          Function : read packet information
    817          INTPUT   : buffer, stores the read information
    818                     FIELD, feild mask
    819                     length, the packet length
    820                     diff_len, diffrence packet length
    821          OUTPUT   : NONE
    822          =================================================================================
    823          */
    824          static void SI446X_PKT_INFO( INT8U *buffer, INT8U FIELD, INT16U length, INT16U diff_len )
    825          {
    826              INT8U cmd[6];
    827              cmd[0] = PACKET_INFO;
    828              cmd[1] = FIELD;
    829              cmd[2] = length >> 8;
    830              cmd[3] = length;
    831              cmd[4] = diff_len >> 8;
    832              cmd[5] = diff_len;
    833          
    834              SI446X_CMD( cmd, 6 );
    835              SI446X_READ_RESPONSE( buffer, 3 );
    836          }
    837          
    838          /*
    839          =================================================================================
    840          SI446X_PKT_INFO_LEN( );
    841          Function : read packet information
    842          INTPUT   : buffer, stores the read information
    843                     FIELD, feild mask
    844                     length, the packet length
    845                     diff_len, diffrence packet length
    846          OUTPUT   : NONE
    847          =================================================================================
    848          */
    849          static INT8U SI446X_PKT_INFO_LEN(INT8U FIELD, INT16U length, INT16U diff_len )
    850          {
    851              INT8U cmd[6];
    852              cmd[0] = PACKET_INFO;
    853              cmd[1] = FIELD;
    854              cmd[2] = length >> 8;
    855              cmd[3] = length;
    856              cmd[4] = diff_len >> 8;
    857              cmd[5] = diff_len;
    858          
    859              SI446X_CMD( cmd, 6 );
    860              SI446X_READ_RESPONSE( cmd, 3 );
    861              return cmd[2];
    862          }
    863          
    864          /*
    865          =================================================================================
    866          SI446X_FIFO_INFO( );
    867          Function : read fifo information
    868          INTPUT   : buffer, stores the read information
    869          OUTPUT   : NONE
    870          =================================================================================
    871          */
    872          static void SI446X_FIFO_INFO( INT8U *buffer )
    873          {
    874              INT8U cmd[2];
    875              cmd[0] = FIFO_INFO;
    876              cmd[1] = 0x03;
    877          
    878              SI446X_CMD( cmd, 2 );
    879              SI446X_READ_RESPONSE( buffer, 3);
    880          }
    881          /*
    882          =================================================================================
    883          SI446X_GPIO_CONFIG( );
    884          Function : config the GPIOs, IRQ, SDO
    885          INTPUT   :
    886          OUTPUT   : NONE
    887          =================================================================================
    888          */
    889          static void SI446X_GPIO_CONFIG( INT8U G0, INT8U G1, INT8U G2, INT8U G3,
    890                                   INT8U IRQ, INT8U SDO, INT8U GEN_CONFIG )
    891          {
    892              INT8U cmd[10];
    893              cmd[0] = GPIO_PIN_CFG;
    894              cmd[1] = G0;
    895              cmd[2] = G1;
    896              cmd[3] = G2;
    897              cmd[4] = G3;
    898              cmd[5] = IRQ;
    899              cmd[6] = SDO;
    900              cmd[7] = GEN_CONFIG;
    901              SI446X_CMD( cmd, 8 );
    902              SI446X_READ_RESPONSE( cmd, 8 );
    903          }
    904          
    905          /*
    906          * \breif config global_config for reconfig fifo tx and rx  two FIFOs are combined 
    907          *		 into a single 129-byte shared FIFO
    908          * note user add                    
    909          */
    910          

   \                                 In section .far_func.text, align 1, keep-with-next
    911          static void SI446X_GLOGAL_CFG_CMMBINED_FIFO(void)
    912          {
    913          	SI446X_SET_PROPERTY_1(GLOBAL_CONFIG, 0x30);
   \                     SI446X_GLOGAL_CFG_CMMBINED_FIFO:
   \   000000 A6 30        LD        A, #0x30
   \   000002 AE 0003      LDW       X, #0x3
   \   000005 AC ......    JPF       SI446X_SET_PROPERTY_1
    914          }
    915          
    916          
    917          /*! This function sends the PART_INFO command to the radio and receives the answer
    918           *  into @Si446xCmd union.
    919           */
    920          static void SI446X_GET_PART_INFO(void)
    921          {
    922          	INT8U ubacmd[16] = {0};
    923          	INT8U *pcmd = (INT8U *)&ubacmd[1];
    924          	
    925          	SI446X_PART_INFO(ubacmd);
    926          	
    927              Si446xCmd.PART_INFO.CHIPREV         = pcmd[0];
    928              Si446xCmd.PART_INFO.PART            = ((U16)pcmd[1] << 8) & 0xFF00;
    929              Si446xCmd.PART_INFO.PART           |= (U16)pcmd[2] & 0x00FF;
    930              Si446xCmd.PART_INFO.PBUILD          = pcmd[3];
    931              Si446xCmd.PART_INFO.ID              = ((U16)pcmd[4] << 8) & 0xFF00;
    932              Si446xCmd.PART_INFO.ID             |= (U16)pcmd[5] & 0x00FF;
    933              Si446xCmd.PART_INFO.CUSTOMER        = pcmd[6];
    934              Si446xCmd.PART_INFO.ROMID           = pcmd[7];
    935          }
    936          
    937          /* Full driver support functions */
    938          
    939          /*!
    940           * Sends the FUNC_INFO command to the radio, then reads the resonse into @Si446xCmd union.
    941           */
    942          static void SI446X_GET_FUNC_INFO(void)
    943          {
    944          	INT8U ubacmd[16] = {0x00};
    945          	INT8U *pcmd = (INT8U *)&ubacmd[1];
    946          
    947          	SI446X_FUNC_INFO(ubacmd);
    948          	
    949              Si446xCmd.FUNC_INFO.REVEXT          = pcmd[0];
    950              Si446xCmd.FUNC_INFO.REVBRANCH       = pcmd[1];
    951              Si446xCmd.FUNC_INFO.REVINT          = pcmd[2];
    952              Si446xCmd.FUNC_INFO.FUNC            = pcmd[5];
    953          }
    954          
    955          /*!
    956           * Get the Interrupt status/pending flags form the radio and clear flags if requested.
    957           *
    958           * @param PH_CLR_PEND     Packet Handler pending flags clear.
    959           * @param MODEM_CLR_PEND  Modem Status pending flags clear.
    960           * @param CHIP_CLR_PEND   Chip State pending flags clear.
    961           */

   \                                 In section .far_func.text, align 1, keep-with-next
    962          static void SI446X_GET_INT_STATUS(void)
    963          {
   \                     SI446X_GET_INT_STATUS:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 52 10        SUB       SP, #0x10
    964          	INT8U ubacmd[16] = {0x00};
   \   000006 90AE ....    LDW       Y, #`?<Constant {0}>_2`
   \   00000A 96           LDW       X, SP
   \   00000B 1C 0001      ADDW      X, #0x1
   \   00000E 89           PUSHW     X
   \   00000F A6 10        LD        A, #0x10
   \   000011 8D ......    CALLF     L:?move1616_v_x_y_a
   \   000015 85           POPW      X
    965          	INT8U *pcmd = (INT8U *)&ubacmd[1];
   \   000016 96           LDW       X, SP
   \   000017 1C 0002      ADDW      X, #0x2
   \   00001A BF ..        LDW       S:?w4, X
    966          
    967          	SI446X_INT_STATUS(ubacmd);
   \   00001C 96           LDW       X, SP
   \   00001D 1C 0001      ADDW      X, #0x1
   \   000020 8D ......    CALLF     SI446X_INT_STATUS
    968          	
    969              Si446xCmd.GET_INT_STATUS.INT_PEND       = pcmd[0];
   \   000024 92C6 ..      LD        A, [S:?w4.w]
   \   000027 C7 ....      LD        L:Si446xCmd, A
    970              Si446xCmd.GET_INT_STATUS.INT_STATUS     = pcmd[1];
   \   00002A BE ..        LDW       X, S:?w4
   \   00002C 5C           INCW      X
   \   00002D F6           LD        A, (X)
   \   00002E C7 ....      LD        L:Si446xCmd + 1, A
    971              Si446xCmd.GET_INT_STATUS.PH_PEND        = pcmd[2];
   \   000031 BE ..        LDW       X, S:?w4
   \   000033 1C 0002      ADDW      X, #0x2
   \   000036 F6           LD        A, (X)
   \   000037 C7 ....      LD        L:Si446xCmd + 2, A
    972              Si446xCmd.GET_INT_STATUS.PH_STATUS      = pcmd[3];
   \   00003A BE ..        LDW       X, S:?w4
   \   00003C 1C 0003      ADDW      X, #0x3
   \   00003F F6           LD        A, (X)
   \   000040 C7 ....      LD        L:Si446xCmd + 3, A
    973              Si446xCmd.GET_INT_STATUS.MODEM_PEND     = pcmd[4];
   \   000043 BE ..        LDW       X, S:?w4
   \   000045 1C 0004      ADDW      X, #0x4
   \   000048 F6           LD        A, (X)
   \   000049 C7 ....      LD        L:Si446xCmd + 4, A
    974              Si446xCmd.GET_INT_STATUS.MODEM_STATUS   = pcmd[5];
   \   00004C BE ..        LDW       X, S:?w4
   \   00004E 1C 0005      ADDW      X, #0x5
   \   000051 F6           LD        A, (X)
   \   000052 C7 ....      LD        L:Si446xCmd + 5, A
    975              Si446xCmd.GET_INT_STATUS.CHIP_PEND      = pcmd[6];
   \   000055 BE ..        LDW       X, S:?w4
   \   000057 1C 0006      ADDW      X, #0x6
   \   00005A F6           LD        A, (X)
   \   00005B C7 ....      LD        L:Si446xCmd + 6, A
    976              Si446xCmd.GET_INT_STATUS.CHIP_STATUS    = pcmd[7];
   \   00005E BE ..        LDW       X, S:?w4
   \   000060 1C 0007      ADDW      X, #0x7
   \   000063 F6           LD        A, (X)
   \   000064 C7 ....      LD        L:Si446xCmd + 7, A
    977          }
   \   000067 5B 10        ADD       SP, #0x10
   \   000069 AC ......    JPF       L:?epilogue_w4
    978          
    979          
    980          
    981          /*!
    982           * Requests the current state of the device and lists pending TX and RX requests
    983           */
    984          static void SI446X_REQUEST_DEVICE_STATE(void)//si446x_request_device_state(void)
    985          {
    986                                        
    987              INT8U ubacmd[16] = {0x00};
    988          	INT8U *pcmd = (INT8U *)&ubacmd[1];
    989          	
    990              ubacmd[0] = SI446X_CMD_ID_REQUEST_DEVICE_STATE;
    991          
    992              SI446X_CMD(ubacmd, SI446X_CMD_ARG_COUNT_REQUEST_DEVICE_STATE);
    993              SI446X_READ_RESPONSE(ubacmd, SI446X_CMD_REPLY_COUNT_REQUEST_DEVICE_STATE+1);
    994          
    995              Si446xCmd.REQUEST_DEVICE_STATE.CURR_STATE       = pcmd[0];
    996              Si446xCmd.REQUEST_DEVICE_STATE.CURRENT_CHANNEL  = pcmd[1];
    997          }
    998          
    999          
   1000          /*!
   1001           * Requests the current state of the device and lists pending TX and RX requests
   1002           */
   1003          static void SI446X_REQUEST_DEVICE_STATE_CH(INT8U *pState, INT8U *pChannel)//si446x_request_device_state(void)
   1004          {
   1005          	#if 0
   1006              Pro2Cmd[0] = SI446X_CMD_ID_REQUEST_DEVICE_STATE;
   1007              radio_comm_SendCmdGetResp( SI446X_CMD_ARG_COUNT_REQUEST_DEVICE_STATE,
   1008                                        Pro2Cmd,
   1009                                        SI446X_CMD_REPLY_COUNT_REQUEST_DEVICE_STATE,
   1010                                        Pro2Cmd );
   1011              #endif
   1012                                        
   1013              INT8U ubacmd[16] = {0x00};
   1014          	INT8U *pcmd = (INT8U *)&ubacmd[1];
   1015          	
   1016              ubacmd[0] = SI446X_CMD_ID_REQUEST_DEVICE_STATE;
   1017          
   1018              SI446X_CMD(ubacmd, SI446X_CMD_ARG_COUNT_REQUEST_DEVICE_STATE);
   1019              SI446X_READ_RESPONSE(ubacmd, SI446X_CMD_REPLY_COUNT_REQUEST_DEVICE_STATE+1);
   1020          
   1021              *pState = pcmd[0];
   1022              *pChannel = pcmd[1];
   1023          }
   1024          
   1025          /*!
   1026           * Gets the Modem status flags. Optionally clears them.
   1027           *
   1028           * @param MODEM_CLR_PEND Flags to clear.
   1029           */

   \                                 In section .far_func.text, align 1, keep-with-next
   1030          static void SI446X_GET_MODEM_STATUS( INT8U MODEM_CLR_PEND )
   1031          {
   \                     SI446X_GET_MODEM_STATUS:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 52 10        SUB       SP, #0x10
   \   000006 B7 ..        LD        S:?b0, A
   1032          
   1033              INT8U ubacmd[16] = {0x00};
   \   000008 90AE ....    LDW       Y, #`?<Constant {0}>_3`
   \   00000C 96           LDW       X, SP
   \   00000D 1C 0001      ADDW      X, #0x1
   \   000010 89           PUSHW     X
   \   000011 A6 10        LD        A, #0x10
   \   000013 8D ......    CALLF     L:?move1616_v_x_y_a
   \   000017 85           POPW      X
   1034          	INT8U *pcmd = (u_char *)&ubacmd[1];
   \   000018 96           LDW       X, SP
   \   000019 1C 0002      ADDW      X, #0x2
   \   00001C BF ..        LDW       S:?w4, X
   1035          
   1036              ubacmd[0] = SI446X_CMD_ID_GET_MODEM_STATUS;
   \   00001E A6 22        LD        A, #0x22
   \   000020 6B 01        LD        (0x1,SP), A
   1037              ubacmd[1] = MODEM_CLR_PEND;
   \   000022 B6 ..        LD        A, S:?b0
   \   000024 6B 02        LD        (0x2,SP), A
   1038              
   1039              SI446X_CMD(ubacmd, SI446X_CMD_ARG_COUNT_GET_MODEM_STATUS);
   \   000026 A6 02        LD        A, #0x2
   \   000028 96           LDW       X, SP
   \   000029 1C 0001      ADDW      X, #0x1
   \   00002C 8D ......    CALLF     SI446X_CMD
   1040              SI446X_READ_RESPONSE(ubacmd, SI446X_CMD_REPLY_COUNT_GET_MODEM_STATUS+1);
   \   000030 A6 09        LD        A, #0x9
   \   000032 96           LDW       X, SP
   \   000033 1C 0001      ADDW      X, #0x1
   \   000036 8D ......    CALLF     SI446X_READ_RESPONSE
   1041          
   1042          
   1043              Si446xCmd.GET_MODEM_STATUS.MODEM_PEND   = pcmd[0];
   \   00003A 92C6 ..      LD        A, [S:?w4.w]
   \   00003D C7 ....      LD        L:Si446xCmd, A
   1044              Si446xCmd.GET_MODEM_STATUS.MODEM_STATUS = pcmd[1];
   \   000040 BE ..        LDW       X, S:?w4
   \   000042 5C           INCW      X
   \   000043 F6           LD        A, (X)
   \   000044 C7 ....      LD        L:Si446xCmd + 1, A
   1045              Si446xCmd.GET_MODEM_STATUS.CURR_RSSI    = pcmd[2];
   \   000047 BE ..        LDW       X, S:?w4
   \   000049 1C 0002      ADDW      X, #0x2
   \   00004C F6           LD        A, (X)
   \   00004D C7 ....      LD        L:Si446xCmd + 2, A
   1046              Si446xCmd.GET_MODEM_STATUS.LATCH_RSSI   = pcmd[3];
   \   000050 BE ..        LDW       X, S:?w4
   \   000052 1C 0003      ADDW      X, #0x3
   \   000055 F6           LD        A, (X)
   \   000056 C7 ....      LD        L:Si446xCmd + 3, A
   1047              Si446xCmd.GET_MODEM_STATUS.ANT1_RSSI    = pcmd[4];
   \   000059 BE ..        LDW       X, S:?w4
   \   00005B 1C 0004      ADDW      X, #0x4
   \   00005E F6           LD        A, (X)
   \   00005F C7 ....      LD        L:Si446xCmd + 4, A
   1048              Si446xCmd.GET_MODEM_STATUS.ANT2_RSSI    = pcmd[5];
   \   000062 BE ..        LDW       X, S:?w4
   \   000064 1C 0005      ADDW      X, #0x5
   \   000067 F6           LD        A, (X)
   \   000068 C7 ....      LD        L:Si446xCmd + 5, A
   1049              Si446xCmd.GET_MODEM_STATUS.AFC_FREQ_OFFSET =  ((U16)pcmd[6] << 8) & 0xFF00;
   \   00006B BE ..        LDW       X, S:?w4
   \   00006D 1C 0006      ADDW      X, #0x6
   \   000070 F6           LD        A, (X)
   \   000071 5F           CLRW      X
   \   000072 97           LD        XL, A
   \   000073 4F           CLR       A
   \   000074 02           RLWA      X, A
   \   000075 CF ....      LDW       L:Si446xCmd + 6, X
   1050              Si446xCmd.GET_MODEM_STATUS.AFC_FREQ_OFFSET |= (U16)pcmd[7] & 0x00FF;
   \   000078 BE ..        LDW       X, S:?w4
   \   00007A 1C 0007      ADDW      X, #0x7
   \   00007D F6           LD        A, (X)
   \   00007E 905F         CLRW      Y
   \   000080 9097         LD        YL, A
   \   000082 CE ....      LDW       X, L:Si446xCmd + 6
   \   000085 90BF ..      LDW       S:?w0, Y
   \   000088 01           RRWA      X, A
   \   000089 BA ..        OR        A, S:?b1
   \   00008B 01           RRWA      X, A
   \   00008C BA ..        OR        A, S:?b0
   \   00008E 01           RRWA      X, A
   \   00008F CF ....      LDW       L:Si446xCmd + 6, X
   1051          }
   \   000092 5B 10        ADD       SP, #0x10
   \   000094 AC ......    JPF       L:?epilogue_w4
   1052          
   1053          
   1054          
   1055          
   1056          
   1057          
   1058          /*!
   1059           * GET current rssi
   1060           *
   1061           * @param MODEM_CLR_PEND Flags to clear.
   1062           */

   \                                 In section .far_func.text, align 1, keep-with-next
   1063          static INT8U SI446X_GET_CUR_RSSI(void)
   1064          {
   \                     SI446X_GET_CUR_RSSI:
   \   000000 8D ......    CALLF     L:?push_w4
   \   000004 52 10        SUB       SP, #0x10
   1065          
   1066              INT8U ubacmd[16] = {0x00};
   \   000006 90AE ....    LDW       Y, #`?<Constant {0}>_4`
   \   00000A 96           LDW       X, SP
   \   00000B 1C 0001      ADDW      X, #0x1
   \   00000E 89           PUSHW     X
   \   00000F A6 10        LD        A, #0x10
   \   000011 8D ......    CALLF     L:?move1616_v_x_y_a
   \   000015 85           POPW      X
   1067          	INT8U *pcmd = (u_char *)&ubacmd[1];
   \   000016 96           LDW       X, SP
   \   000017 1C 0002      ADDW      X, #0x2
   \   00001A BF ..        LDW       S:?w4, X
   1068          
   1069              ubacmd[0] = SI446X_CMD_ID_GET_MODEM_STATUS;
   \   00001C A6 22        LD        A, #0x22
   \   00001E 6B 01        LD        (0x1,SP), A
   1070              ubacmd[1] = 0x7f;
   \   000020 A6 7F        LD        A, #0x7f
   \   000022 6B 02        LD        (0x2,SP), A
   1071              
   1072              SI446X_CMD(ubacmd, SI446X_CMD_ARG_COUNT_GET_MODEM_STATUS);
   \   000024 A6 02        LD        A, #0x2
   \   000026 96           LDW       X, SP
   \   000027 1C 0001      ADDW      X, #0x1
   \   00002A 8D ......    CALLF     SI446X_CMD
   1073              SI446X_READ_RESPONSE(ubacmd, SI446X_CMD_REPLY_COUNT_GET_MODEM_STATUS+1);
   \   00002E A6 09        LD        A, #0x9
   \   000030 96           LDW       X, SP
   \   000031 1C 0001      ADDW      X, #0x1
   \   000034 8D ......    CALLF     SI446X_READ_RESPONSE
   1074          
   1075          	/*
   1076              Si446xCmd.GET_MODEM_STATUS.MODEM_PEND   = pcmd[0];
   1077              Si446xCmd.GET_MODEM_STATUS.MODEM_STATUS = pcmd[1];
   1078              Si446xCmd.GET_MODEM_STATUS.CURR_RSSI    = pcmd[2];
   1079              Si446xCmd.GET_MODEM_STATUS.LATCH_RSSI   = pcmd[3];
   1080              Si446xCmd.GET_MODEM_STATUS.ANT1_RSSI    = pcmd[4];
   1081              Si446xCmd.GET_MODEM_STATUS.ANT2_RSSI    = pcmd[5];
   1082              Si446xCmd.GET_MODEM_STATUS.AFC_FREQ_OFFSET =  ((U16)pcmd[6] << 8) & 0xFF00;
   1083              Si446xCmd.GET_MODEM_STATUS.AFC_FREQ_OFFSET |= (U16)pcmd[7] & 0x00FF;
   1084              */
   1085              return pcmd[2];
   \   000038 BE ..        LDW       X, S:?w4
   \   00003A 1C 0002      ADDW      X, #0x2
   \   00003D F6           LD        A, (X)
   \   00003E 5B 10        ADD       SP, #0x10
   \   000040 AC ......    JPF       L:?epilogue_w4
   1086          }
   1087          
   1088          
   1089          /*
   1090          =================================================================================
   1091          SI446X_GET_FIFO_INFO_RX_BYTES( );
   1092          Function : read fifo information
   1093          INTPUT   : none
   1094          OUTPUT   : rx fifo bytes
   1095          =================================================================================
   1096          */
   1097          static INT8U SI446X_GET_FIFO_INFO_RX_BYTES(void)
   1098          {
   1099              INT8U cmd[2];
   1100              INT8U ubaBuf[3] = {0x00};
   1101              cmd[0] = FIFO_INFO;
   1102              cmd[1] = 0x00;
   1103          
   1104              SI446X_CMD( cmd, 2 );
   1105              SI446X_READ_RESPONSE( ubaBuf, 3);
   1106              return ubaBuf[1];
   1107          }
   1108          
   1109          
   1110          
   1111          /*------------------------------------------------------------------------------------------*/
   1112          

   \                                 In section .near.bss, align 1
   1113          static volatile INT8U si446x_ubpksent = 0;
   \                     si446x_ubpksent:
   \   000000              DS8 1
   1114          
   1115          //void si446x_frr_ctl_cfg(void);
   1116          
   1117          

   \                                 In section .far_func.text, align 1, keep-with-next
   1118          void si446x_set_pksent(void)
   1119          {
   1120          	si446x_ubpksent = 1;
   \                     si446x_set_pksent:
   \   000000 35 01 ....   MOV       L:si446x_ubpksent, #0x1
   1121          }
   \   000004 87           RETF
   1122          
   1123          

   \                                 In section .far_func.text, align 1, keep-with-next
   1124          static int si446x_wait_pksent(void)
   1125          {
   1126          	#if 1
   1127          	INT32U timeout = 0;
   \                     si446x_wait_pksent:
   \   000000 5F           CLRW      X
   \   000001 BF ..        LDW       S:?w1, X
   \   000003 BF ..        LDW       S:?w0, X
   1128          	si446x_ubpksent = 0;
   \   000005 35 00 ....   MOV       L:si446x_ubpksent, #0x0
   1129          	while(!si446x_ubpksent)
   \                     ??si446x_wait_pksent_0:
   \   000009 C6 ....      LD        A, L:si446x_ubpksent
   \   00000C A1 00        CP        A, #0x0
   \   00000E 26 15        JRNE      L:??si446x_wait_pksent_1
   1130          	{
   1131          		timeout++;
   \   000010 8D ......    CALLF     L:?inc32_l0_l0
   1132          		if ( timeout > 7200000)//time out
   \   000014 BE ..        LDW       X, S:?w0
   \   000016 A3 006D      CPW       X, #0x6d
   \   000019 26 05        JRNE      L:??si446x_wait_pksent_2
   \   00001B BE ..        LDW       X, S:?w1
   \   00001D A3 DD01      CPW       X, #0xdd01
   \                     ??si446x_wait_pksent_2:
   \   000020 25 E7        JRC       L:??si446x_wait_pksent_0
   1133          		{
   1134          			return 1;
   \   000022 5F           CLRW      X
   \   000023 5C           INCW      X
   \   000024 87           RETF
   1135          		}
   1136          	}
   1137          	si446x_ubpksent = 0;
   \                     ??si446x_wait_pksent_1:
   \   000025 35 00 ....   MOV       L:si446x_ubpksent, #0x0
   1138          	return 0;
   \   000029 5F           CLRW      X
   \   00002A 87           RETF
   1139          	#else
   1140          	#endif
   1141          }
   1142          
   1143          
   1144          //close nirq pin interrupt

   \                                 In section .far_func.text, align 1, keep-with-next
   1145          static void si446x_nirq_disable(void)
   1146          {
   1147          	//RF_NIRQ_DISABLE();
   1148          	
   1149          }
   \                     si446x_nirq_disable:
   \   000000 87           RETF
   1150          

   \                                 In section .far_func.text, align 1, keep-with-next
   1151          static void clock_wait(u_long udwTime)
   1152          {
   \                     clock_wait:
   \   000000 8D ......    CALLF     L:?mov_l1_l0
   1153          	unsigned int i,k;
   1154          	for(k = 0; k < udwTime; k++)
   \   000004 905F         CLRW      Y
   \   000006 20 0A        JRA       L:??clock_wait_0
   1155          	{
   1156          		for(i = 0; i<3190; i++)
   \                     ??clock_wait_1:
   \   000008 5C           INCW      X
   \                     ??clock_wait_2:
   \   000009 A3 0C76      CPW       X, #0xc76
   \   00000C 25 FA        JRC       L:??clock_wait_1
   \   00000E 93           LDW       X, Y
   \   00000F 5C           INCW      X
   \   000010 9093         LDW       Y, X
   \                     ??clock_wait_0:
   \   000012 90BF ..      LDW       S:?w1, Y
   \   000015 5F           CLRW      X
   \   000016 BF ..        LDW       S:?w0, X
   \   000018 8D ......    CALLF     L:?ucmp32_c_l0_l1
   \   00001C 24 03        JRNC      L:??clock_wait_3
   \   00001E 5F           CLRW      X
   \   00001F 20 E8        JRA       L:??clock_wait_2
   1157          		{
   1158          			;
   1159          		}
   1160          	}		
   1161          }
   \                     ??clock_wait_3:
   \   000021 87           RETF
   1162          

   \                                 In section .far_func.text, align 1, keep-with-next
   1163          static void si446x_rst( )
   1164          {
   1165              RF_SDN(1);
   \                     si446x_rst:
   \   000000 C6 5005      LD        A, L:0x5005
   \   000003 AA 08        OR        A, #0x8
   \   000005 C7 5005      LD        L:0x5005, A
   \   000008 5F           CLRW      X
   \   000009 97           LD        XL, A
   1166              clock_wait(1);
   \   00000A 5F           CLRW      X
   \   00000B BF ..        LDW       S:?w0, X
   \   00000D 5C           INCW      X
   \   00000E BF ..        LDW       S:?w1, X
   \   000010 8D ......    CALLF     clock_wait
   1167              /*delay code*/
   1168              
   1169              RF_SDN(0);
   \   000014 C6 5005      LD        A, L:0x5005
   \   000017 A4 F7        AND       A, #0xf7
   \   000019 C7 5005      LD        L:0x5005, A
   \   00001C 5F           CLRW      X
   \   00001D 97           LD        XL, A
   1170              /*delay code*/
   1171              clock_wait(20);
   \   00001E AE 0014      LDW       X, #0x14
   \   000021 BF ..        LDW       S:?w1, X
   \   000023 5F           CLRW      X
   \   000024 BF ..        LDW       S:?w0, X
   \   000026 8D ......    CALLF     clock_wait
   1172              RF_SPINSEL(1);   
   \   00002A C6 5005      LD        A, L:0x5005
   \   00002D AA 10        OR        A, #0x10
   \   00002F C7 5005      LD        L:0x5005, A
   \   000032 5F           CLRW      X
   \   000033 97           LD        XL, A
   1173          }
   \   000034 87           RETF
   1174          

   \                                 In section .far_func.text, align 1, keep-with-next
   1175          static void si446x_nIRQ_Config(void)
   1176          {
   1177          	//RF_NIRQ_CFG( );
   1178          	EXTI_SetPinSensitivity(EXTI_Pin_4, EXTI_Trigger_Falling);
   \                     si446x_nIRQ_Config:
   \   000000 35 02 ....   MOV       S:?b0, #0x2
   \   000004 A6 10        LD        A, #0x10
   \   000006 8D ......    CALLF     EXTI_SetPinSensitivity
   1179          	GPIO_Init(RF_NIRQ_PORT, RF_NIRQ_PIN, GPIO_Mode_In_PU_IT);
   \   00000A 35 60 ....   MOV       S:?b0, #0x60
   \   00000E A6 10        LD        A, #0x10
   \   000010 AE 500F      LDW       X, #0x500f
   \   000013 AC ......    JPF       GPIO_Init
   1180          }
   1181          
   1182          //open nirq pin interrupt
   1183          static void si446x_nirq_enable(void)
   1184          {
   1185          
   1186          }
   1187          

   \                                 In section .far_func.text, align 1, keep-with-next
   1188          void si446xRadioInit(void)
   1189          {
   1190          	rfchnum = 0;
   \                     si446xRadioInit:
   \   000000 35 00 ....   MOV       L:rfchnum, #0x0
   1191          
   1192          	si446x_nirq_disable( );
   \   000004 8D ......    CALLF     si446x_nirq_disable
   1193          	//SPI_Config( );
   1194          	spiInit( );
   \   000008 8D ......    CALLF     spiInit
   1195          
   1196              si446x_rst( );        //SI446X 模块复位
   \   00000C 8D ......    CALLF     si446x_rst
   1197              
   1198              SI446X_RADIO_CONFIG_INIT( ); //config radio param
   \   000010 8D ......    CALLF     SI446X_RADIO_CONFIG_INIT
   1199          
   1200              SI446X_RADIO_PKT_COMMON_CFG( );
   \   000014 8D ......    CALLF     SI446X_RADIO_PKT_COMMON_CFG
   1201              SI446X_RADIO_TX_FIELD_CFG( );
   \   000018 8D ......    CALLF     SI446X_RADIO_TX_FIELD_CFG
   1202              SI446X_RADIO_RX_FIELD_CFG( );
   \   00001C 8D ......    CALLF     SI446X_RADIO_RX_FIELD_CFG
   1203              
   1204          	si446x_get_int_status( );
   \   000020 8D ......    CALLF     si446x_get_int_status
   1205          	memset(Si446xCmd.RAW, 0, 16);
   \   000024 AE 0010      LDW       X, #0x10
   \   000027 BF ..        LDW       S:?w0, X
   \   000029 905F         CLRW      Y
   \   00002B AE ....      LDW       X, #Si446xCmd
   \   00002E 8D ......    CALLF     memset
   1206          
   1207              si446x_nIRQ_Config( );
   \   000032 8D ......    CALLF     si446x_nIRQ_Config
   1208              si446xStartRX( );
   \   000036 AC ......    JPF       si446xStartRX
   1209          }
   1210          
   1211          

   \                                 In section .far_func.text, align 1, keep-with-next
   1212          void si446x_recfg(void)
   1213          {
   1214          	si446x_nirq_disable( );
   \                     si446x_recfg:
   \   000000 8D ......    CALLF     si446x_nirq_disable
   1215          	//SPI_Config( );
   1216              spiInit( );
   \   000004 8D ......    CALLF     spiInit
   1217          	
   1218              si446x_rst( );        //SI446X 模块复位
   \   000008 8D ......    CALLF     si446x_rst
   1219              SI446X_RADIO_CONFIG_INIT( ); //config radio param
   \   00000C 8D ......    CALLF     SI446X_RADIO_CONFIG_INIT
   1220          
   1221              SI446X_RADIO_PKT_COMMON_CFG( );
   \   000010 8D ......    CALLF     SI446X_RADIO_PKT_COMMON_CFG
   1222              SI446X_RADIO_TX_FIELD_CFG( );
   \   000014 8D ......    CALLF     SI446X_RADIO_TX_FIELD_CFG
   1223              SI446X_RADIO_RX_FIELD_CFG( );
   \   000018 8D ......    CALLF     SI446X_RADIO_RX_FIELD_CFG
   1224          
   1225              si446x_get_int_status( );
   \   00001C 8D ......    CALLF     si446x_get_int_status
   1226          	    
   1227              si446x_nIRQ_Config( );
   \   000020 8D ......    CALLF     si446x_nIRQ_Config
   1228              si446xStartRX( );
   \   000024 AC ......    JPF       si446xStartRX
   1229          }
   1230          
   1231          
   1232          

   \                                 In section .far_func.text, align 1, keep-with-next
   1233          u_char si446x_get_rfch(void)
   1234          {
   1235          	return rfchnum;
   \                     si446x_get_rfch:
   \   000000 C6 ....      LD        A, L:rfchnum
   \   000003 87           RETF
   1236          }
   1237          
   1238          

   \                                 In section .far_func.text, align 1, keep-with-next
   1239          u_char si446x_set_rfch(u_char ubchannel)
   1240          {
   \                     si446x_set_rfch:
   \   000000 B7 ..        LD        S:?b1, A
   1241          	u_char ubOldchannel = rfchnum;
   \   000002 C6 ....      LD        A, L:rfchnum
   \   000005 B7 ..        LD        S:?b0, A
   1242          	rfchnum = ubchannel;
   \   000007 B6 ..        LD        A, S:?b1
   \   000009 C7 ....      LD        L:rfchnum, A
   1243          	return ubOldchannel;
   \   00000C B6 ..        LD        A, S:?b0
   \   00000E 87           RETF
   1244          }
   1245          
   1246          
   1247          /*
   1248          * \brief This funtion is used to init tx, rx fifo, and combine two 64 bytes fifo to 129 bytes fifo
   1249          *        and start rx at HWLH_TEST_CH channel, 
   1250          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1251          void si446xStartRX(void)
   1252          {
   1253          	si446x_get_int_status( );
   \                     si446xStartRX:
   \   000000 8D ......    CALLF     si446x_get_int_status
   1254          	memset(Si446xCmd.RAW, 0, 16);
   \   000004 AE 0010      LDW       X, #0x10
   \   000007 BF ..        LDW       S:?w0, X
   \   000009 905F         CLRW      Y
   \   00000B AE ....      LDW       X, #Si446xCmd
   \   00000E 8D ......    CALLF     memset
   1255          	//SI446X_START_RX(rfchnum, 0, 0, 0,0x00,0x03);
   1256          	SI446X_START_RX(rfchnum, 0, 0, 0,0x03,0x08);
                 	                ^
Warning[Pe188]: enumerated type mixed with another type

  	SI446X_START_RX(rfchnum, 0, 0, 0,0x03,0x08);
  	                         ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1256  Warning[Pe188]: 
          enumerated type mixed with another type

  	SI446X_START_RX(rfchnum, 0, 0, 0,0x03,0x08);
  	                               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1256  Warning[Pe188]: 
          enumerated type mixed with another type

  	SI446X_START_RX(rfchnum, 0, 0, 0,0x03,0x08);
  	                                 ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1256  Warning[Pe188]: 
          enumerated type mixed with another type

  	SI446X_START_RX(rfchnum, 0, 0, 0,0x03,0x08);
  	                                      ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1256  Warning[Pe188]: 
          enumerated type mixed with another type

  static void SI446X_RX_FIFO_RESET( void )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",768  Warning[Pe177]: 
          function "SI446X_RX_FIFO_RESET" was declared but never referenced

  static void SI446X_TX_FIFO_RESET( void )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",784  Warning[Pe177]: 
          function "SI446X_TX_FIFO_RESET" was declared but never referenced

  static void SI446X_POWER_UP( INT32U f_xtal )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",81  Warning[Pe177]: 
          function "SI446X_POWER_UP" was declared but never referenced

  static INT8U SI446X_NOP( void )
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",131  Warning[Pe177]: 
          function "SI446X_NOP" was declared but never referenced

  static void SI446X_GET_PROPERTY_X( SI446X_PROPERTY GROUP_NUM, INT8U NUM_PROPS, INT8U *buffer  )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",216  Warning[Pe177]: 
          function "SI446X_GET_PROPERTY_X" was declared but never referenced

  static void SI446X_SET_PROPERTY_X( SI446X_PROPERTY GROUP_NUM, INT8U NUM_PROPS, INT8U *PAR_BUFF )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",242  Warning[Pe177]: 
          function "SI446X_SET_PROPERTY_X" was declared but never referenced

  static void SI446X_RESET( void )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",313  Warning[Pe177]: 
          function "SI446X_RESET" was declared but never referenced

  static void SI446X_CONFIG_INIT( void )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",374  Warning[Pe177]: 
          function "SI446X_CONFIG_INIT" was declared but never referenced

  static void SI446X_W_TX_FIFO( INT8U *txbuffer, INT8U size )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",552  Warning[Pe177]: 
          function "SI446X_W_TX_FIFO" was declared but never referenced

  static void  SI446X_SEND_DATA( INT8U *txbuffer, INT8U size, INT8U channel, INT8U condition )
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",574  Warning[Pe177]: 
          function "SI446X_SEND_DATA" was declared but never referenced

  static INT8U SI446X_READ_PACKET( INT8U *buffer )
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",644  Warning[Pe177]: 
          function "SI446X_READ_PACKET" was declared but never referenced

  static void SI446X_READ_PACKET_LEN( INT8U *pibuf )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",679  Warning[Pe177]: 
          function "SI446X_READ_PACKET_LEN" was declared but never referenced

  static INT8U SI446X_READ_DATA_TO_BUF( INT8U *pbuf , INT8U ubNum)
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",703  Warning[Pe177]: 
          function "SI446X_READ_DATA_TO_BUF" was declared but never referenced

  static void SI446X_PKT_INFO( INT8U *buffer, INT8U FIELD, INT16U length, INT16U diff_len )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",824  Warning[Pe177]: 
          function "SI446X_PKT_INFO" was declared but never referenced

  static INT8U SI446X_PKT_INFO_LEN(INT8U FIELD, INT16U length, INT16U diff_len )
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",849  Warning[Pe177]: 
          function "SI446X_PKT_INFO_LEN" was declared but never referenced

  static void SI446X_FIFO_INFO( INT8U *buffer )
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",872  Warning[Pe177]: 
          function "SI446X_FIFO_INFO" was declared but never referenced

  static void SI446X_GET_PART_INFO(void)
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",920  Warning[Pe177]: 
          function "SI446X_GET_PART_INFO" was declared but never referenced

  static void SI446X_GET_FUNC_INFO(void)
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",942  Warning[Pe177]: 
          function "SI446X_GET_FUNC_INFO" was declared but never referenced

  static void SI446X_REQUEST_DEVICE_STATE(void)//si446x_request_device_state(void)
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",984  Warning[Pe177]: 
          function "SI446X_REQUEST_DEVICE_STATE" was declared but never
          referenced

  static void SI446X_REQUEST_DEVICE_STATE_CH(INT8U *pState, INT8U *pChannel)//si446x_request_device_state(void)
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1003  Warning[Pe177]: 
          function "SI446X_REQUEST_DEVICE_STATE_CH" was declared but never
          referenced

  static INT8U SI446X_GET_FIFO_INFO_RX_BYTES(void)
               ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1097  Warning[Pe177]: 
          function "SI446X_GET_FIFO_INFO_RX_BYTES" was declared but never
          referenced

  static void si446x_nirq_enable(void)
              ^
"E:\hwpro-2016\20160627_L\si4438\radiolib\si446x.c",1183  Warning[Pe177]: 
          function "si446x_nirq_enable" was declared but never referenced
   \   000012 35 08 ....   MOV       S:?b3, #0x8
   \   000016 35 03 ....   MOV       S:?b2, #0x3
   \   00001A 3F ..        CLR       S:?b1
   \   00001C 5F           CLRW      X
   \   00001D 3F ..        CLR       S:?b0
   \   00001F C6 ....      LD        A, L:rfchnum
   \   000022 AC ......    JPF       SI446X_START_RX
   1257          }
   1258          
   1259          /*
   1260          * \brief This funtion is used to init tx, rx fifo, and combine two 64 bytes fifo to 129 bytes fifo 
   1261          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1262          void si446xToRx(void)
   1263          {
   1264              SI446X_TXRX_FIFO_RESET( );
   \                     si446xToRx:
   \   000000 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
   1265              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   000004 8D ......    CALLF     SI446X_GLOGAL_CFG_CMMBINED_FIFO
   1266          	SI446X_CHANGE_STATE(8);
   \   000008 A6 08        LD        A, #0x8
   \   00000A AC ......    JPF       SI446X_CHANGE_STATE
   1267          }
   1268          
   1269          

   \                                 In section .far_func.text, align 1, keep-with-next
   1270          void si446x_reset_fifo(void)
   1271          {
   1272              SI446X_TXRX_FIFO_RESET( );
   \                     si446x_reset_fifo:
   \   000000 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
   1273              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   000004 AC ......    JPF       SI446X_GLOGAL_CFG_CMMBINED_FIFO
   1274          }
   1275          
   1276          /*----------------------------------------------------------------------------*/
   1277          /** \brief  This function will download a frame to the radio transceiver's frame
   1278           *          buffer.
   1279           *
   1280           *  \param  data        Pointer to data that is to be written to frame buffer, data[0] is data length, data[0]+1
   1281           *						is total packet length.
   1282           *  \param  len         Length of data. The maximum length is large 64 bytes.
   1283           */

   \                                 In section .far_func.text, align 1, keep-with-next
   1284          int si446xRadioSendFixLenData(const INT8U *pubdata)
   1285          {
   \                     si446xRadioSendFixLenData:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 8D ......    CALLF     L:?push_w7
   \   000008 3B ....      PUSH      S:?b12
   \   00000B BF ..        LDW       S:?w5, X
   1286          	INT8U ubDataNLen = 0;
   \   00000D 3F ..        CLR       S:?b12
   1287          	const INT8U *pbuf = pubdata;
   1288          	int nResult = 0;
   \   00000F 3F ..        CLR       S:?b15
   \   000011 3F ..        CLR       S:?b14
   1289          	int i = 0;
   \   000013 3F ..        CLR       S:?b9
   \   000015 3F ..        CLR       S:?b8
   1290          	//u_char ubState;
   1291          	//u_char ubCh;
   1292          	
   1293          	SI446X_CHANGE_STATE(5);
   \   000017 A6 05        LD        A, #0x5
   \   000019 8D ......    CALLF     SI446X_CHANGE_STATE
   1294          	//SI446X_CHANGE_STATE(3);
   1295          	ubDataNLen = pubdata[0] + 1;
   \   00001D 92C6 ..      LD        A, [S:?w5.w]
   \   000020 AB 01        ADD       A, #0x1
   \   000022 B7 ..        LD        S:?b12, A
   1296              SI446X_TXRX_FIFO_RESET( );
   \   000024 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
   1297              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   000028 8D ......    CALLF     SI446X_GLOGAL_CFG_CMMBINED_FIFO
   1298          
   1299          	si446x_get_int_status( );
   \   00002C 8D ......    CALLF     si446x_get_int_status
   1300          	memset(Si446xCmd.RAW, 0, 16);
   \   000030 AE 0010      LDW       X, #0x10
   \   000033 BF ..        LDW       S:?w0, X
   \   000035 905F         CLRW      Y
   \   000037 AE ....      LDW       X, #Si446xCmd
   \   00003A 8D ......    CALLF     memset
   1301          
   1302          
   1303              RF_SPINSEL(0);
   \   00003E C6 5005      LD        A, L:0x5005
   \   000041 A4 EF        AND       A, #0xef
   \   000043 C7 5005      LD        L:0x5005, A
   \   000046 5F           CLRW      X
   \   000047 97           LD        XL, A
   1304              SPI_SendByteData(WRITE_TX_FIFO);
   \   000048 A6 66        LD        A, #0x66
   \   00004A 8D ......    CALLF     SPI_SendByteData
   1305              for (i = 0; i < ubDataNLen; i++)
   \   00004E 5F           CLRW      X
   \   00004F BF ..        LDW       S:?w4, X
   \   000051 20 10        JRA       L:??si446xRadioSendFixLenData_0
   1306              {
   1307              	SPI_SendByteData( pbuf[i]); 
   \                     ??si446xRadioSendFixLenData_1:
   \   000053 BE ..        LDW       X, S:?w4
   \   000055 72BB ....    ADDW      X, S:?w5
   \   000059 F6           LD        A, (X)
   \   00005A 8D ......    CALLF     SPI_SendByteData
   1308              }
   \   00005E BE ..        LDW       X, S:?w4
   \   000060 5C           INCW      X
   \   000061 BF ..        LDW       S:?w4, X
   \                     ??si446xRadioSendFixLenData_0:
   \   000063 5F           CLRW      X
   \   000064 41           EXG       A, XL
   \   000065 B6 ..        LD        A, S:?b12
   \   000067 41           EXG       A, XL
   \   000068 BF ..        LDW       S:?w0, X
   \   00006A BE ..        LDW       X, S:?w4
   \   00006C B3 ..        CPW       X, S:?w0
   \   00006E 2F E3        JRSLT     L:??si446xRadioSendFixLenData_1
   1309              RF_SPINSEL(1);
   \   000070 C6 5005      LD        A, L:0x5005
   \   000073 AA 10        OR        A, #0x10
   \   000075 C7 5005      LD        L:0x5005, A
   \   000078 5F           CLRW      X
   \   000079 97           LD        XL, A
   1310              
   1311          	//SI446X_SET_PROPERTY_1(INT_CTL_PH_ENABLE, SI446X_INT_CTL_PH_PSENT_EN);
   1312          	//SI446X_SET_PROPERTY_1(INT_CTL_MODEM_ENABLE, 0x00);
   1313          	//SI446X_START_TX(HWLH_TEST_CH, 0, ubDataNLen);
   1314          	//SI446X_START_TX(rfchnum, 0, ubDataNLen);
   1315          	
   1316          	SI446X_START_TX(rfchnum, 0x80, ubDataNLen);
   \   00007A 5F           CLRW      X
   \   00007B 41           EXG       A, XL
   \   00007C B6 ..        LD        A, S:?b12
   \   00007E 41           EXG       A, XL
   \   00007F 35 80 ....   MOV       S:?b0, #0x80
   \   000083 C6 ....      LD        A, L:rfchnum
   \   000086 8D ......    CALLF     SI446X_START_TX
   1317          	nResult = si446x_wait_pksent( );
   \   00008A 8D ......    CALLF     si446x_wait_pksent
   \   00008E BF ..        LDW       S:?w7, X
   1318          	si446xStartRX( );
   \   000090 8D ......    CALLF     si446xStartRX
   1319          	return nResult;
   \   000094 BE ..        LDW       X, S:?w7
   \   000096 32 ....      POP       S:?b12
   \   000099 8D ......    CALLF     L:?pop_w7
   \   00009D AC ......    JPF       L:?epilogue_l2
   1320          }
   1321          
   1322          static void si446xWriteMutiData(const INT8U *pcBuf, INT8U ubDataLen)
                             ^
Warning[Pe177]: function "si446xWriteMutiData" was declared but never
          referenced
   1323          {
   1324          	int i = 0;
   1325          	SI446X_WAIT_CTS( );
   1326          
   1327              RF_SPINSEL(0);
   1328              SPI_SendByteData( WRITE_TX_FIFO );
   1329              for (i = 0; i < ubDataLen; i++)
   1330              {
   1331              	SPI_SendByteData( pcBuf[i]);
   1332              }
   1333          	RF_SPINSEL(1);
   1334          }
   1335          

   \                                 In section .far_func.text, align 1, keep-with-next
   1336          void si446xReadMutiData(INT8U *pBuf)
   1337          {
   \                     si446xReadMutiData:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 8D ......    CALLF     L:?push_w6
   \   000008 3B ....      PUSH      S:?b14
   \   00000B BF ..        LDW       S:?w5, X
   1338          	int i = 0;
   \   00000D 3F ..        CLR       S:?b9
   \   00000F 3F ..        CLR       S:?b8
   1339          	INT8U ubLen = 0;
   \   000011 3F ..        CLR       S:?b14
   1340          	u_char *pData = pBuf+1;
   \   000013 BE ..        LDW       X, S:?w5
   \   000015 5C           INCW      X
   \   000016 BF ..        LDW       S:?w6, X
   1341          	//ubLen = SI446X_PKT_INFO_LEN(0, 0, 0);
   1342          	//ubLen = SI446X_GET_FIFO_INFO_RX_BYTES( );
   1343          	SI446X_WAIT_CTS( );
   \   000018 8D ......    CALLF     SI446X_WAIT_CTS
   1344              RF_SPINSEL(0);
   \   00001C C6 5005      LD        A, L:0x5005
   \   00001F A4 EF        AND       A, #0xef
   \   000021 C7 5005      LD        L:0x5005, A
   \   000024 5F           CLRW      X
   \   000025 97           LD        XL, A
   1345              SPI_SendByteData( READ_RX_FIFO );
   \   000026 A6 77        LD        A, #0x77
   \   000028 8D ......    CALLF     SPI_SendByteData
   1346              ubLen = SPI_SendByteData(0xFF);
   \   00002C A6 FF        LD        A, #0xff
   \   00002E 8D ......    CALLF     SPI_SendByteData
   \   000032 B7 ..        LD        S:?b14, A
   1347              //ubLen = pData[0];
   1348              if (ubLen + 1 > 128 )
   \   000034 5F           CLRW      X
   \   000035 41           EXG       A, XL
   \   000036 B6 ..        LD        A, S:?b14
   \   000038 41           EXG       A, XL
   \   000039 5C           INCW      X
   \   00003A A3 0081      CPW       X, #0x81
   \   00003D 2F 06        JRSLT     L:??si446xReadMutiData_0
   1349              {
   1350              	pBuf[0] = 0;
   \   00003F 4F           CLR       A
   \   000040 92C7 ..      LD        [S:?w5.w], A
   1351              	return;
   \   000043 20 34        JRA       L:??si446xReadMutiData_1
   1352              }
   1353              for (i = 0; i < ubLen; i++)
   \                     ??si446xReadMutiData_0:
   \   000045 3F ..        CLR       S:?b9
   \   000047 3F ..        CLR       S:?b8
   \   000049 20 12        JRA       L:??si446xReadMutiData_2
   1354              {
   1355              	pData[i]=SPI_SendByteData(0xFF);
   \                     ??si446xReadMutiData_3:
   \   00004B A6 FF        LD        A, #0xff
   \   00004D 8D ......    CALLF     SPI_SendByteData
   \   000051 BE ..        LDW       X, S:?w4
   \   000053 72BB ....    ADDW      X, S:?w6
   \   000057 F7           LD        (X), A
   1356              }
   \   000058 BE ..        LDW       X, S:?w4
   \   00005A 5C           INCW      X
   \   00005B BF ..        LDW       S:?w4, X
   \                     ??si446xReadMutiData_2:
   \   00005D 5F           CLRW      X
   \   00005E 41           EXG       A, XL
   \   00005F B6 ..        LD        A, S:?b14
   \   000061 41           EXG       A, XL
   \   000062 BF ..        LDW       S:?w0, X
   \   000064 BE ..        LDW       X, S:?w4
   \   000066 B3 ..        CPW       X, S:?w0
   \   000068 2F E1        JRSLT     L:??si446xReadMutiData_3
   1357              pBuf[0] = ubLen;
   \   00006A B6 ..        LD        A, S:?b14
   \   00006C 92C7 ..      LD        [S:?w5.w], A
   1358          	RF_SPINSEL(1);
   \   00006F C6 5005      LD        A, L:0x5005
   \   000072 AA 10        OR        A, #0x10
   \   000074 C7 5005      LD        L:0x5005, A
   \   000077 5F           CLRW      X
   \   000078 97           LD        XL, A
   1359          }
   \                     ??si446xReadMutiData_1:
   \   000079 32 ....      POP       S:?b14
   \   00007C AC ......    JPF       L:?epilogue_l2_w6
   1360          
   1361          

   \                                 In section .far_func.text, align 1, keep-with-next
   1362          static void si446x_frr_ctl_cfg(void)
   1363          {
   1364          	SI446X_SET_PROPERTY_1(FRR_CTL_A_MODE, FRR_MODE_INT_CHIP_PEND);
   \                     si446x_frr_ctl_cfg:
   \   000000 A6 08        LD        A, #0x8
   \   000002 AE 0200      LDW       X, #0x200
   \   000005 8D ......    CALLF     SI446X_SET_PROPERTY_1
   1365          	SI446X_SET_PROPERTY_1(FRR_CTL_B_MODE, FRR_MODE_INT_PH_PEND);
   \   000009 A6 04        LD        A, #0x4
   \   00000B AE 0201      LDW       X, #0x201
   \   00000E 8D ......    CALLF     SI446X_SET_PROPERTY_1
   1366          	SI446X_SET_PROPERTY_1(FRR_CTL_C_MODE, FRR_MODE_INT_MODEM_PEND);
   \   000012 A6 06        LD        A, #0x6
   \   000014 AE 0202      LDW       X, #0x202
   \   000017 8D ......    CALLF     SI446X_SET_PROPERTY_1
   1367          	SI446X_SET_PROPERTY_1(FRR_CTL_D_MODE, FRR_MODE_CURRENT_STATE);
   \   00001B A6 09        LD        A, #0x9
   \   00001D AE 0203      LDW       X, #0x203
   \   000020 AC ......    JPF       SI446X_SET_PROPERTY_1
   1368          }
   1369          
   1370          /*
   1371          * \brief start rx
   1372          * \param channel   the rf channel is used for receive data
   1373          * \param condition start rx immediate or after WUT
   1374          * \param rx_len    receive data length, when zero receive variable data, not zero receive fix len data
   1375          * \param n_state1  This parameter selects the desired operational state of the chip to automatically enter upon timeout of Preamble detection.
   1376          * \param n_state2  This parameter selects the desired operational state of the chip to automatically enter upon reception of a valid packet.
   1377          * \parma n_state3  This parameter selects the desired operational state of the chip to automatically enter upon reception of an invalid packet.
   1378          */
   1379          

   \                                 In section .far_func.text, align 1, keep-with-next
   1380          void si446x_start_rx( SI446X_RF_CH channel, SI446X_RX_CONDITION condition, INT16U rx_len,
   1381                                SI446X_DEV_STATE n_state1, SI446X_DEV_STATE n_state2, SI446X_DEV_STATE n_state3)
   1382          {
   \                     si446x_start_rx:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 8D ......    CALLF     L:?push_w6
   \   000008 3B ....      PUSH      S:?b14
   \   00000B B7 ..        LD        S:?b10, A
   \   00000D 45 .. ..     MOV       S:?b11, S:?b0
   \   000010 BF ..        LDW       S:?w4, X
   \   000012 45 .. ..     MOV       S:?b12, S:?b1
   \   000015 45 .. ..     MOV       S:?b13, S:?b2
   \   000018 45 .. ..     MOV       S:?b14, S:?b3
   1383              SI446X_TXRX_FIFO_RESET( );
   \   00001B 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
   1384              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   00001F 8D ......    CALLF     SI446X_GLOGAL_CFG_CMMBINED_FIFO
   1385          	//SI446X_SET_PROPERTY_1(INT_CTL_PH_ENABLE, SI446X_INT_CTL_PH_PRX_EN|SI446X_INT_CTL_PH_CRCE_EN);
   1386          	//SI446X_SET_PROPERTY_1(INT_CTL_MODEM_ENABLE, SI446X_INT_CTL_MODEM_SYDE_EN);
   1387          	//SI446X_START_RX( channel, 0, 0,0,0,0x03 );
   1388          	SI446X_START_RX( channel, condition, rx_len, n_state1, n_state2, n_state3 );
   \   000023 45 .. ..     MOV       S:?b3, S:?b14
   \   000026 45 .. ..     MOV       S:?b2, S:?b13
   \   000029 45 .. ..     MOV       S:?b1, S:?b12
   \   00002C BE ..        LDW       X, S:?w4
   \   00002E 45 .. ..     MOV       S:?b0, S:?b11
   \   000031 B6 ..        LD        A, S:?b10
   \   000033 8D ......    CALLF     SI446X_START_RX
   1389          }
   \   000037 32 ....      POP       S:?b14
   \   00003A AC ......    JPF       L:?epilogue_l2_w6
   1390          
   1391          
   1392          /*----------------------------------------------------------------------------*/
   1393          /** \brief  This function will download a frame to the radio transceiver's frame
   1394           *          buffer.
   1395           *
   1396           *  \param  pubdata        Pointer to data that is to be written to frame buffer.
   1397           *  \param  channel        radio send channel
   1398           *  \param  condition	   radio condition after send packet
   1399           *  \param  tx_len		   send data length
   1400           */

   \                                 In section .far_func.text, align 1, keep-with-next
   1401          int si446x_send_fix_len_data(const INT8U *pubdata, SI446X_RF_CH channel, SI446X_TX_CONDITION condition, INT16U tx_len)
   1402          {
   \                     si446x_send_fix_len_data:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 8D ......    CALLF     L:?push_l3
   \   000008 52 02        SUB       SP, #0x2
   \   00000A B7 ..        LD        S:?b12, A
   \   00000C 45 .. ..     MOV       S:?b13, S:?b0
   \   00000F 90BF ..      LDW       S:?w7, Y
   1403          	//when data length > 64, 
   1404          	const INT8U *pbuf = pubdata;
   \   000012 1F 01        LDW       (0x1,SP), X
   1405          	int nResult = 0;
   \   000014 3F ..        CLR       S:?b11
   \   000016 3F ..        CLR       S:?b10
   1406          	int i = 0;
   \   000018 3F ..        CLR       S:?b9
   \   00001A 3F ..        CLR       S:?b8
   1407          
   1408          	SI446X_CHANGE_STATE(5);
   \   00001C A6 05        LD        A, #0x5
   \   00001E 8D ......    CALLF     SI446X_CHANGE_STATE
   1409          
   1410              SI446X_TXRX_FIFO_RESET( );
   \   000022 8D ......    CALLF     SI446X_TXRX_FIFO_RESET
   1411              SI446X_GLOGAL_CFG_CMMBINED_FIFO( );
   \   000026 8D ......    CALLF     SI446X_GLOGAL_CFG_CMMBINED_FIFO
   1412          
   1413              RF_SPINSEL(0);
   \   00002A C6 5005      LD        A, L:0x5005
   \   00002D A4 EF        AND       A, #0xef
   \   00002F C7 5005      LD        L:0x5005, A
   \   000032 5F           CLRW      X
   \   000033 97           LD        XL, A
   1414              SPI_SendByteData(WRITE_TX_FIFO);
   \   000034 A6 66        LD        A, #0x66
   \   000036 8D ......    CALLF     SPI_SendByteData
   1415              for (i = 0; i < tx_len; i++)
   \   00003A 5F           CLRW      X
   \   00003B BF ..        LDW       S:?w4, X
   \   00003D 20 0F        JRA       L:??si446x_send_fix_len_data_0
   1416              {
   1417              	SPI_SendByteData( pbuf[i]); 
   \                     ??si446x_send_fix_len_data_1:
   \   00003F BE ..        LDW       X, S:?w4
   \   000041 72FB 01      ADDW      X, (0x1,SP)
   \   000044 F6           LD        A, (X)
   \   000045 8D ......    CALLF     SPI_SendByteData
   1418              }
   \   000049 BE ..        LDW       X, S:?w4
   \   00004B 5C           INCW      X
   \   00004C BF ..        LDW       S:?w4, X
   \                     ??si446x_send_fix_len_data_0:
   \   00004E BE ..        LDW       X, S:?w4
   \   000050 B3 ..        CPW       X, S:?w7
   \   000052 25 EB        JRC       L:??si446x_send_fix_len_data_1
   1419              RF_SPINSEL(1);
   \   000054 C6 5005      LD        A, L:0x5005
   \   000057 AA 10        OR        A, #0x10
   \   000059 C7 5005      LD        L:0x5005, A
   \   00005C 5F           CLRW      X
   \   00005D 97           LD        XL, A
   1420              
   1421          	//SI446X_SET_PROPERTY_1(INT_CTL_PH_ENABLE, SI446X_INT_CTL_PH_PSENT_EN);
   1422          	//SI446X_SET_PROPERTY_1(INT_CTL_MODEM_ENABLE, 0x00);
   1423          	//SI446X_START_TX(HWLH_TEST_CH, 0, ubDataNLen);
   1424          	SI446X_START_TX(channel, condition, tx_len);
   \   00005E BE ..        LDW       X, S:?w7
   \   000060 45 .. ..     MOV       S:?b0, S:?b13
   \   000063 B6 ..        LD        A, S:?b12
   \   000065 8D ......    CALLF     SI446X_START_TX
   1425          
   1426          	nResult = si446x_wait_pksent( );
   \   000069 8D ......    CALLF     si446x_wait_pksent
   \   00006D BF ..        LDW       S:?w5, X
   1427          	si446xToRx( );
   \   00006F 8D ......    CALLF     si446xToRx
   1428          	return nResult;
   \   000073 BE ..        LDW       X, S:?w5
   \   000075 5B 02        ADD       SP, #0x2
   \   000077 AC ......    JPF       L:?epilogue_l2_l3
   1429          }
   1430          
   1431          /*
   1432          * \brief init the radio param
   1433          * \note before this, need to init spi
   1434          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1435          void si446x_radio_init(void)
   1436          {
   1437              SI446X_RADIO_CONFIG_INIT( ); //config radio param
   \                     si446x_radio_init:
   \   000000 8D ......    CALLF     SI446X_RADIO_CONFIG_INIT
   1438              SI446X_RADIO_PKT_COMMON_CFG( );
   \   000004 8D ......    CALLF     SI446X_RADIO_PKT_COMMON_CFG
   1439              SI446X_RADIO_TX_FIELD_CFG( );
   \   000008 8D ......    CALLF     SI446X_RADIO_TX_FIELD_CFG
   1440              SI446X_RADIO_RX_FIELD_CFG( );
   \   00000C 8D ......    CALLF     SI446X_RADIO_RX_FIELD_CFG
   1441          
   1442              si446x_frr_ctl_cfg( );
   \   000010 8D ......    CALLF     si446x_frr_ctl_cfg
   1443          
   1444              si446x_nIRQ_Config( );
   \   000014 8D ......    CALLF     si446x_nIRQ_Config
   1445              si446xStartRX( );
   \   000018 AC ......    JPF       si446xStartRX
   1446          }
   1447          
   1448          
   1449          /*
   1450          * \brief Read specify length from fifo
   1451          * \param pioBuf the pointer to the buf that save data
   1452          * \param ubLen data length
   1453          */
   1454          

   \                                 In section .far_func.text, align 1, keep-with-next
   1455          void si446x_read_data(INT8U *pioBuf, INT8U ubLen)
   1456          {
   \                     si446x_read_data:
   \   000000 8D ......    CALLF     L:?push_l2
   \   000004 3B ....      PUSH      S:?b12
   \   000007 BF ..        LDW       S:?w5, X
   \   000009 B7 ..        LD        S:?b12, A
   1457          	int i = 0;
   \   00000B 3F ..        CLR       S:?b9
   \   00000D 3F ..        CLR       S:?b8
   1458          	SI446X_WAIT_CTS( );
   \   00000F 8D ......    CALLF     SI446X_WAIT_CTS
   1459              RF_SPINSEL(0);
   \   000013 C6 5005      LD        A, L:0x5005
   \   000016 A4 EF        AND       A, #0xef
   \   000018 C7 5005      LD        L:0x5005, A
   \   00001B 5F           CLRW      X
   \   00001C 97           LD        XL, A
   1460              SPI_SendByteData( READ_RX_FIFO );
   \   00001D A6 77        LD        A, #0x77
   \   00001F 8D ......    CALLF     SPI_SendByteData
   1461              for (i = 0; i < ubLen; i++)
   \   000023 5F           CLRW      X
   \   000024 BF ..        LDW       S:?w4, X
   \   000026 20 12        JRA       L:??si446x_read_data_0
   1462              {
   1463              	pioBuf[i]=SPI_SendByteData(0xFF);
   \                     ??si446x_read_data_1:
   \   000028 A6 FF        LD        A, #0xff
   \   00002A 8D ......    CALLF     SPI_SendByteData
   \   00002E BE ..        LDW       X, S:?w4
   \   000030 72BB ....    ADDW      X, S:?w5
   \   000034 F7           LD        (X), A
   1464              }
   \   000035 BE ..        LDW       X, S:?w4
   \   000037 5C           INCW      X
   \   000038 BF ..        LDW       S:?w4, X
   \                     ??si446x_read_data_0:
   \   00003A 5F           CLRW      X
   \   00003B 41           EXG       A, XL
   \   00003C B6 ..        LD        A, S:?b12
   \   00003E 41           EXG       A, XL
   \   00003F BF ..        LDW       S:?w0, X
   \   000041 BE ..        LDW       X, S:?w4
   \   000043 B3 ..        CPW       X, S:?w0
   \   000045 2F E1        JRSLT     L:??si446x_read_data_1
   1465          	RF_SPINSEL(1);
   \   000047 C6 5005      LD        A, L:0x5005
   \   00004A AA 10        OR        A, #0x10
   \   00004C C7 5005      LD        L:0x5005, A
   \   00004F 5F           CLRW      X
   \   000050 97           LD        XL, A
   1466          }
   \   000051 32 ....      POP       S:?b12
   \   000054 AC ......    JPF       L:?epilogue_l2
   1467          
   1468          
   1469          
   1470          /*
   1471           * \brief  This function set radio tx power
   1472           *
   1473           * \param  ubPower   New tx power value need to be set  must be <= 0x7f  
   1474          */
   1475          

   \                                 In section .far_func.text, align 1, keep-with-next
   1476          void si446x_set_tx_power(SI446X_TX_POWER_DBM e_txdbm)
   1477          {
   1478          	SI446X_SET_PROPERTY_1(PA_PWR_LVL, e_txdbm&0x7f);
   \                     si446x_set_tx_power:
   \   000000 A4 7F        AND       A, #0x7f
   \   000002 AE 2201      LDW       X, #0x2201
   \   000005 AC ......    JPF       SI446X_SET_PROPERTY_1
   1479          }
   1480          
   1481          
   1482          /*
   1483           * \brief  This function get current radio tx power
   1484           * \return current tx power
   1485          */
   1486          

   \                                 In section .far_func.text, align 1, keep-with-next
   1487          SI446X_TX_POWER_DBM  si446x_get_current_tx_power(void)
   1488          {
   1489          	return (SI446X_TX_POWER_DBM)SI446X_GET_PROPERTY_1(PA_PWR_LVL);
   \                     si446x_get_current_tx_power:
   \   000000 AE 2201      LDW       X, #0x2201
   \   000003 AC ......    JPF       SI446X_GET_PROPERTY_1
   1490          }
   1491          
   1492          
   1493          /*
   1494          
   1495          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1496          void si446x_change_dev_current_state(SI446X_DEV_STATE e_state)
   1497          {
   1498          	SI446X_CHANGE_STATE((INT8U)e_state);
   \                     si446x_change_dev_current_state:
   \   000000 AC ......    JPF       SI446X_CHANGE_STATE
   1499          }
   1500          
   1501          
   1502          /*
   1503          * \brief This funtion is used to read all interrupt values and clear interrupt pend
   1504          *        all interrupt value is save to Si446xCmd
   1505          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1506          void si446x_get_int_status(void)
   1507          {
   1508          	SI446X_GET_INT_STATUS( );
   \                     si446x_get_int_status:
   \   000000 AC ......    JPF       SI446X_GET_INT_STATUS
   1509          }
   1510          

   \                                 In section .far_func.text, align 1, keep-with-next
   1511          INT8U si446x_get_property_1(SI446X_PROPERTY GROUP_NUM)
   1512          {
   1513          	return SI446X_GET_PROPERTY_1(GROUP_NUM);
   \                     si446x_get_property_1:
   \   000000 AC ......    JPF       SI446X_GET_PROPERTY_1
   1514          }
   1515          
   1516          /*
   1517          * \brief This funtion is used to read all modem values 
   1518          *        all modem value is save to Si446xCmd
   1519          */

   \                                 In section .far_func.text, align 1, keep-with-next
   1520          void si446x_get_modem_status(INT8U MODEM_CLR_PEND)
   1521          {
   1522          	SI446X_GET_MODEM_STATUS(MODEM_CLR_PEND);
   \                     si446x_get_modem_status:
   \   000000 AC ......    JPF       SI446X_GET_MODEM_STATUS
   1523          }
   1524          

   \                                 In section .far_func.text, align 1, keep-with-next
   1525          INT8U si446x_get_cur_rssi(void)
   1526          {
   1527          	return SI446X_GET_CUR_RSSI( );
   \                     si446x_get_cur_rssi:
   \   000000 AC ......    JPF       SI446X_GET_CUR_RSSI
   1528          }

   \                                 In section .near.rodata, align 1
   \                     `?<Constant {0}>`:
   \   000000 00 00 00 00  DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \          00 00 00 00 

   \                                 In section .near.rodata, align 1
   \                     `?<Constant "part">`:
   \   000000 70 61 72 74  DC8 "part"
   \          00          

   \                                 In section .near.rodata, align 1
   \                     `?<Constant {0}>_1`:
   \   000000 00 00        DC8 0, 0

   \                                 In section .near.rodata, align 1
   \                     `?<Constant {0}>_2`:
   \   000000 00 00 00 00  DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \          00 00 00 00 

   \                                 In section .near.rodata, align 1
   \                     `?<Constant {0}>_3`:
   \   000000 00 00 00 00  DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \          00 00 00 00 

   \                                 In section .near.rodata, align 1
   \                     `?<Constant {0}>_4`:
   \   000000 00 00 00 00  DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \          00 00 00 00 
   1529          
   1530          #if 0
   1531          /*
   1532          * \brief Fast read A mode
   1533          * \param pioBuf The pointer to buf that save data
   1534          * \param ubLen  read data lengh
   1535          * \note ubLen <=4
   1536          */
   1537          void si446x_frr_a_read(INT8U *pioBuf, INT8U ubLen)
   1538          {
   1539          	int i = 0;
   1540          	RF_SPINSEL(0);
   1541          	SPI_SendByteData(SI446X_CMD_ID_FRR_A_READ);
   1542          	for (i = 0; i < ubLen; i++)
   1543          	{
   1544          		pioBuf[i] = SPI_SendByteData(0xff);
   1545          	}
   1546          	RF_SPINSEL(1); 
   1547          }
   1548          
   1549          /*
   1550          * \brief Fast read b mode
   1551          * \param pioBuf The pointer to buf that save data
   1552          * \param ubLen  read data lengh
   1553          * \note ubLen <=4
   1554          */
   1555          void si446x_frr_b_read(INT8U *pioBuf, INT8U ubLen)
   1556          {
   1557          	int i = 0;
   1558          	INT8U ubCmd = SI446X_CMD_ID_FRR_B_READ;
   1559          	SI446X_CMD(&ubCmd, 1);
   1560          	SI446X_READ_RESPONSE(pioBuf, ubLen);
   1561          }
   1562          
   1563          
   1564          /*
   1565          * \brief Fast read c mode
   1566          * \param pioBuf The pointer to buf that save data
   1567          * \param ubLen  read data lengh
   1568          * \note ubLen <=4
   1569          */
   1570          void si446x_frr_c_read(INT8U *pioBuf, INT8U ubLen)
   1571          {
   1572          	int i = 0;
   1573          	RF_SPINSEL(0);
   1574          	SPI_SendByteData(SI446X_CMD_ID_FRR_C_READ);
   1575          	for (i = 0; i < ubLen; i++)
   1576          	{
   1577          		pioBuf[i] = SPI_SendByteData(0xff);
   1578          	}
   1579          	RF_SPINSEL(1); 
   1580          }
   1581          
   1582          
   1583          
   1584          
   1585          /*
   1586          * \brief Fast read d mode
   1587          * \param pioBuf The pointer to buf that save data
   1588          * \param ubLen  read data lengh
   1589          * \note ubLen <=4
   1590          */
   1591          void si446x_frr_d_read(INT8U *pioBuf, INT8U ubLen)
   1592          {
   1593          	int i = 0;
   1594          	RF_SPINSEL(0);
   1595          	SPI_SendByteData(SI446X_CMD_ID_FRR_D_READ);
   1596          	for (i = 0; i < ubLen; i++)
   1597          	{
   1598          		pioBuf[i] = SPI_SendByteData(0xff);
   1599          	}
   1600          	RF_SPINSEL(1); 
   1601          }
   1602          
   1603          
   1604          
   1605          INT8U si446x_get_frr_chip_pend(void)
   1606          {
   1607          	INT8U ubPend = 0x00;
   1608          	si446x_frr_a_read(&ubPend, 1);
   1609          	return ubPend;
   1610          }
   1611          
   1612          INT8U si446x_get_frr_ph_pend(void)
   1613          {
   1614          	INT8U ubaPend[5] = 0x00;
   1615          	si446x_frr_b_read(ubaPend, 5);
   1616          	MEM_DUMP(10, "PH", ubaPend, 5);
   1617          	return ubaPend[1];
   1618          }
   1619          
   1620          INT8U si446x_get_frr_modem_pend(void)
   1621          {
   1622          	INT8U ubaPend[5] = {0x00};
   1623          	si446x_frr_c_read(ubaPend, 5);
   1624          	return ubaPend[1];
   1625          }
   1626          
   1627          
   1628          INT8U si446x_get_frr_current_state(void)
   1629          {
   1630          	INT8U ubPend = 0x00;
   1631          	si446x_frr_d_read(&ubPend, 1);
   1632          	return ubPend;
   1633          }
   1634          
   1635          
   1636          
   1637          /*!
   1638           * Clear all Interrupt status/pending flags. Does NOT read back interrupt flags
   1639           *
   1640           */
   1641          void si446x_int_status_fast_clear( void )
   1642          {
   1643              INT8U ubCmd = SI446X_CMD_ID_GET_INT_STATUS;
   1644          	SI446X_CMD(&ubCmd, 1);
   1645          }
   1646          #endif
   1647          
   1648          

   Section sizes:

   Bytes  Function/Label
   -----  --------------
       5  ?<Constant "part">
      16  ?<Constant {0}>
       2  ?<Constant {0}>_1
      16  ?<Constant {0}>_2
      16  ?<Constant {0}>_3
      16  ?<Constant {0}>_4
      92  SI446X_CFG_PARAM_INIT
      41  SI446X_CHANGE_STATE
      69  SI446X_CMD
      68  SI446X_GET_CUR_RSSI
     109  SI446X_GET_INT_STATUS
     152  SI446X_GET_MODEM_STATUS
      49  SI446X_GET_PROPERTY_1
       9  SI446X_GLOGAL_CFG_CMMBINED_FIFO
      45  SI446X_INT_STATUS
      65  SI446X_PART_INFO
       3  SI446X_RADIO_CONFIG_INIT
      53  SI446X_RADIO_PKT_COMMON_CFG
      92  SI446X_RADIO_RX_FIELD_CFG
      66  SI446X_RADIO_TX_FIELD_CFG
      77  SI446X_READ_RESPONSE
      43  SI446X_SET_PROPERTY_1
      91  SI446X_START_RX
      41  SI446X_START_TX
      23  SI446X_TXRX_FIFO_RESET
      41  SI446X_WAIT_CTS
      16  Si446xCmd
      34  clock_wait
       1  rfchnum
      58  si446xRadioInit
     161  si446xRadioSendFixLenData
     128  si446xReadMutiData
      38  si446xStartRX
      14  si446xToRx
     365  si446x_cfg
       4  si446x_change_dev_current_state
      36  si446x_frr_ctl_cfg
       4  si446x_get_cur_rssi
       7  si446x_get_current_tx_power
       4  si446x_get_int_status
       4  si446x_get_modem_status
       4  si446x_get_property_1
       4  si446x_get_rfch
      23  si446x_nIRQ_Config
       1  si446x_nirq_disable
      28  si446x_radio_init
      88  si446x_read_data
      40  si446x_recfg
       8  si446x_reset_fifo
      53  si446x_rst
     123  si446x_send_fix_len_data
       5  si446x_set_pksent
      15  si446x_set_rfch
       9  si446x_set_tx_power
      62  si446x_start_rx
       1  si446x_ubpksent
      43  si446x_wait_pksent

 
 2 227 bytes in section .far_func.text
    18 bytes in section .near.bss
   436 bytes in section .near.rodata
 
 2 227 bytes of CODE  memory
   436 bytes of CONST memory
    18 bytes of DATA  memory

Errors: none
Warnings: 32
